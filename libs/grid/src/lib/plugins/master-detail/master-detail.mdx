import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as MasterDetailStories from './master-detail.stories';

<Meta of={MasterDetailStories} />

# Master-Detail Plugin

The Master-Detail plugin displays expandable detail rows beneath master rows.

## Installation

```ts
import { MasterDetailPlugin } from '@toolbox-web/grid/plugins/master-detail';
```

## Basic Usage

```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [...],
  plugins: [
    new MasterDetailPlugin({
      detailRenderer: (row) => `<div>Details for ${row.name}</div>`,
    }),
  ],
};
```

## Demos

### Default Master-Detail

<Canvas of={MasterDetailStories.Default} withToolbar />
<Controls of={MasterDetailStories.Default} />

### Expand on Row Click

<Canvas of={MasterDetailStories.ExpandOnRowClick} withToolbar />

### Fixed Detail Height

<Canvas of={MasterDetailStories.FixedDetailHeight} withToolbar />

## Configuration Options

| Option                   | Type                             | Default   | Description                                      |
| ------------------------ | -------------------------------- | --------- | ------------------------------------------------ |
| `detailRenderer`         | `(row) => HTMLElement \| string` | required  | Render function                                  |
| `expandOnRowClick`       | `boolean`                        | `false`   | Expand on row click                              |
| `detailHeight`           | `number \| 'auto'`               | `'auto'`  | Detail row height                                |
| `collapseOnClickOutside` | `boolean`                        | `false`   | Collapse on click outside                        |
| `showExpandColumn`       | `boolean`                        | `true`    | Show expand/collapse column                      |
| `animation`              | `false \| 'slide' \| 'fade'`     | `'slide'` | Animation style for expanding/collapsing details |

### Animation Options

The `animation` option controls how detail rows appear/disappear:

```ts
// Slide animation (default)
new MasterDetailPlugin({ animation: 'slide', ... });

// Fade animation
new MasterDetailPlugin({ animation: 'fade', ... });

// No animation
new MasterDetailPlugin({ animation: false, ... });
```

> **Note:** Animation respects the grid-level `animation.mode` setting. If the grid has `animation: { mode: 'off' }`, plugin animations are disabled.

## Nested Grid Example

```ts
new MasterDetailPlugin({
  detailRenderer: (row) => {
    const childGrid = document.createElement('tbw-grid');
    childGrid.style.height = '200px';
    childGrid.gridConfig = { columns: [...] };
    childGrid.rows = row.items || [];
    return childGrid;
  },
})
```

## Programmatic API

```ts
const plugin = grid.getPlugin(MasterDetailPlugin);

plugin.expandRow(rowIndex);
plugin.collapseRow(rowIndex);
plugin.toggleRow(rowIndex);
plugin.expandAll();
plugin.collapseAll();
const isExpanded = plugin.isRowExpanded(rowIndex);
```
