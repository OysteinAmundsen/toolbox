/*
 * Material Design 3 Theme
 * Inspired by Material Design 3 / Material You with modern polish.
 * Clean surfaces, subtle elevation, smooth motion, and refined typography.
 * https://m3.material.io/
 */
@layer tbw-theme {
  tbw-grid {
    /* ========== Core Palette ========== */
    /* M3 surface colors with subtle tonal variation */
    --tbw-color-bg: light-dark(#fffbff, #1c1b1f);
    --tbw-color-panel-bg: light-dark(#f7f2fa, #2b2930);
    --tbw-color-fg: light-dark(#1c1b1f, #e6e1e5);
    --tbw-color-fg-muted: light-dark(#49454f, #cac4d0);

    /* Subtle borders for clean look */
    --tbw-color-border: light-dark(#e7e0ec, #49454f);
    --tbw-color-border-strong: light-dark(#79747e, #938f99);
    --tbw-color-border-cell: transparent;
    --tbw-color-border-header: light-dark(#e7e0ec, #49454f);

    /* Row divider - subtle horizontal line */
    --tbw-row-divider: 1px solid light-dark(#e7e0ec, #49454f);

    /* M3 Primary - Purple/Violet */
    --tbw-color-accent: light-dark(#6750a4, #d0bcff);
    --tbw-color-accent-fg: light-dark(#ffffff, #381e72);
    --tbw-color-success: light-dark(#146c2e, #6dd58c);
    --tbw-color-error: light-dark(#b3261e, #f2b8b5);

    /* Selection & interaction with tonal surfaces */
    --tbw-color-selection: light-dark(#e8def8, #4a4458);
    --tbw-color-row-alt: transparent;
    --tbw-color-row-hover: light-dark(rgba(103, 80, 164, 0.08), rgba(208, 188, 255, 0.08));
    --tbw-color-active-row-bg: light-dark(rgba(103, 80, 164, 0.12), rgba(208, 188, 255, 0.12));

    /* Header with subtle surface tint */
    --tbw-color-header-bg: light-dark(#fffbff, #1c1b1f);
    --tbw-color-header-fg: light-dark(#49454f, #cac4d0);

    /* Elevation shadow for panels */
    --tbw-color-shadow: light-dark(rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.3));

    /* ========== Typography ========== */
    --tbw-font-family: 'Roboto Flex', 'Roboto', system-ui, sans-serif;
    --tbw-font-size: 14px;
    --tbw-font-size-header: 12px;
    --tbw-font-weight-header: 500;
    --tbw-header-text-transform: none;
    --tbw-header-letter-spacing: 0.01em;

    /* ========== Spacing & Dimensions ========== */
    /* M3 uses generous whitespace */
    --tbw-cell-padding: 4px 16px;
    --tbw-cell-padding-header: 4px 16px;
    --tbw-row-height: 52px;
    --tbw-header-height: 56px;

    /* M3 uses larger corner radii */
    --tbw-border-radius: 12px;

    /* ========== Motion ========== */
    /* M3 emphasizing motion - smooth, intentional transitions */
    --tbw-transition-duration: 200ms;
    --tbw-transition-ease: cubic-bezier(0.2, 0, 0, 1);
    --tbw-animation-duration: 300ms;
    --tbw-animation-easing: cubic-bezier(0.2, 0, 0, 1);

    /* ========== Focus & Selection ========== */
    --tbw-focus-outline: 2px solid var(--tbw-color-accent);
    --tbw-focus-outline-offset: 2px;
    --tbw-focus-background: rgba(from var(--tbw-color-accent) r g b / 12%);

    --tbw-range-border-color: var(--tbw-color-accent);
    --tbw-range-selection-bg: rgba(from var(--tbw-color-accent) r g b / 12%);

    /* ========== Resize Handle ========== */
    --tbw-resize-handle-color: transparent;
    --tbw-resize-handle-color-hover: var(--tbw-color-accent);
    --tbw-resize-handle-border-radius: 4px;

    /* ========== Sort Indicators ========== */
    --tbw-sort-indicator-color: light-dark(#49454f, #cac4d0);
    --tbw-sort-indicator-active-color: var(--tbw-color-accent);

    /* ========== Borders ========== */
    --tbw-border-header: 1px solid light-dark(#e7e0ec, #49454f);
    --tbw-border-input: 1px solid light-dark(#79747e, #938f99);
    --tbw-editing-border: 2px solid var(--tbw-color-accent);

    /* ========== Scrollbar ========== */
    --tbw-scrollbar-thumb: light-dark(#d0d0d8, #49454f);
    --tbw-scrollbar-track: transparent;

    /* ========== Tool Panel ========== */
    --tbw-tool-panel-bg: light-dark(#f7f2fa, #2b2930);
    --tbw-shell-header-bg: light-dark(#fffbff, #1c1b1f);

    /* ========== Row Animations ========== */
    --tbw-row-change-color: rgba(from var(--tbw-color-accent) r g b / 20%);

    /* ========== M3 Header Icons ========== */
    /* M3 uses larger, bolder icons (18px vs default 12px) */
    --tbw-icon-size: 18px;
    --tbw-icon-size-sm: 16px;

    /* Sort indicator — larger for M3, works with any icon type */
    .header-row .cell > span[part~='sort-indicator'] {
      font-size: var(--tbw-icon-size-sm);

      > * {
        width: 1em;
        height: 1em;
      }
    }

    /* Filter button — larger for M3, works with any icon type */
    .header-row .cell .tbw-filter-btn {
      font-size: var(--tbw-icon-size-sm);

      > * {
        width: 1em;
        height: 1em;
      }
    }

    /* ========== M3 Filled Text Fields ========== */
    /* Material Design 3 filled text field: tinted background, bottom border, accent on focus */
    .data-grid-row > .cell.editing input:not([type='checkbox']),
    .data-grid-row > .cell.editing select,
    .data-grid-row > .cell.editing textarea {
      background: var(--tbw-color-panel-bg);
      color: var(--tbw-color-fg);
      border: none;
      border-bottom: 1px solid var(--tbw-color-border-strong);
      border-radius: 4px 4px 0 0;
      padding: 8px 12px;
      font-family: var(--tbw-font-family);
      font-size: var(--tbw-font-size);
      caret-color: var(--tbw-color-accent);
      outline: none;
      transition: border-color 150ms var(--tbw-transition-ease);

      &:focus {
        border-bottom: 2px solid var(--tbw-color-accent);
        padding-bottom: 7px; /* compensate for thicker border */
      }
    }

    /* M3 select dropdown caret */
    .data-grid-row > .cell.editing select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2379747e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 28px;
    }

    /* ========== M3 Editing border override ========== */
    --tbw-editing-border: none;
    --tbw-editing-row-outline-width: 2px;
  }

  tbw-grid,
  .tbw-filter-panel {
    /* ========== M3 Checkboxes ========== */
    /* Material Design 3 styled checkboxes for all grid & filter panel checkboxes */
    input[type='checkbox'] {
      appearance: none;
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid var(--tbw-color-border-strong);
      border-radius: 2px;
      background: transparent;
      position: relative;
      transition:
        background-color 100ms cubic-bezier(0.2, 0, 0, 1),
        border-color 100ms cubic-bezier(0.2, 0, 0, 1);
      cursor: pointer;
      outline: none;
      vertical-align: middle;
      flex-shrink: 0;

      &::after {
        content: '';
        position: absolute;
        display: none;
        left: 4px;
        top: 0;
        width: 5px;
        height: 10px;
        border: solid var(--tbw-color-accent-fg);
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      &:checked {
        background-color: var(--tbw-color-accent);
        border-color: var(--tbw-color-accent);

        &::after {
          display: block;
        }
      }

      &:indeterminate {
        background-color: var(--tbw-color-accent);
        border-color: var(--tbw-color-accent);

        &::after {
          display: block;
          left: 3px;
          top: 6px;
          width: 8px;
          height: 0;
          border-width: 0 0 2px 0;
          transform: none;
        }
      }

      &:hover::before {
        content: '';
        position: absolute;
        inset: -10px;
        border-radius: 50%;
        background: rgba(from var(--tbw-color-accent) r g b / 8%);
      }

      &:focus-visible::before {
        content: '';
        position: absolute;
        inset: -10px;
        border-radius: 50%;
        background: rgba(from var(--tbw-color-accent) r g b / 12%);
      }
    }

    /* ========== M3 Checkboxes ========== */
    /* Material Design 3 buttons */
    button {
      font-weight: 500;
      letter-spacing: 0.01em;
      min-height: 36px;
      border-radius: 20px;
      transition:
        filter 150ms var(--tbw-transition-ease),
        box-shadow 150ms var(--tbw-transition-ease);
    }
  }

  .tbw-filter-panel {
    /* Provide --tbw-* values for filter panel (rendered outside tbw-grid) */
    --tbw-color-accent: light-dark(#6750a4, #d0bcff);
    --tbw-color-accent-fg: light-dark(#fff, #381e72);
    --tbw-color-border-strong: light-dark(#79747e, #938f99);
    --tbw-color-panel-bg: light-dark(#f7f2fa, #2b2930);
    --tbw-color-row-hover: light-dark(rgba(103, 80, 164, 0.08), rgba(208, 188, 255, 0.08));
    --tbw-transition-ease: cubic-bezier(0.2, 0, 0, 1);
    --tbw-filter-item-height: 36px;

    /* M3 surface container with tonal elevation */
    border-radius: 12px;
    font-family: 'Roboto Flex', 'Roboto', system-ui, sans-serif;
    box-shadow:
      0 1px 3px 0 rgba(0, 0, 0, 0.3),
      0 4px 8px 3px rgba(0, 0, 0, 0.15);

    /* M3 filled text fields — shared base for all text inputs */
    .tbw-filter-search-input,
    .tbw-filter-range-input,
    .tbw-filter-date-input {
      background: var(--tbw-color-panel-bg);
      border: none;
      border-bottom: 1px solid var(--tbw-color-border-strong);
      border-radius: 4px 4px 0 0;
      height: 36px;
      padding: 8px 12px;
      font-family: inherit;
      caret-color: var(--tbw-color-accent);
      transition: border-color 150ms var(--tbw-transition-ease);

      &:focus {
        border-bottom: 2px solid var(--tbw-color-accent);
        padding-bottom: 7px;
        box-shadow: none;
      }
    }

    /* M3 value items with ripple-like hover */
    .tbw-filter-value-item {
      border-radius: 8px;
      transition: background 150ms var(--tbw-transition-ease);

      &:hover {
        background: var(--tbw-color-row-hover);
      }
    }

    /* M3 buttons — shared base */

    /* Filled button (Apply) */
    .tbw-filter-apply-btn {
      &:hover {
        filter: brightness(1.08);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
      }
    }

    /* Outlined button (Clear) */
    .tbw-filter-clear-btn {
      color: var(--tbw-color-accent);
      border-color: var(--tbw-color-border-strong);

      &:hover {
        background: var(--tbw-color-row-hover);
      }
    }

    /* M3 range slider */
    .tbw-filter-range-track,
    .tbw-filter-range-fill {
      height: 4px;
      border-radius: 2px;
    }

    .tbw-filter-range-thumb::-webkit-slider-thumb {
      width: 20px;
      height: 20px;
      border: none;
      box-shadow:
        0 1px 3px rgba(0, 0, 0, 0.2),
        0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .tbw-filter-range-thumb::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border: none;
      box-shadow:
        0 1px 3px rgba(0, 0, 0, 0.2),
        0 1px 2px rgba(0, 0, 0, 0.1);
    }
  }
} /* End @layer tbw-theme */
