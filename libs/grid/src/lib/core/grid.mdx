import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as GridStories from './grid.stories';

<Meta of={GridStories} />

# Core Grid Component

The `<tbw-grid>` is a high-performance, framework-agnostic data grid web component built with pure TypeScript.

## Features

| Feature                    | Description                                          |
| -------------------------- | ---------------------------------------------------- |
| üöÄ **Virtualization**      | Handles 100k+ rows with smooth scrolling             |
| üîß **Framework Agnostic**  | Works in vanilla JS, React, Vue, Angular, Svelte     |
| ‚å®Ô∏è **Keyboard Navigation** | Full arrow key, Tab, Enter, Escape support           |
| üé® **Themeable**           | CSS custom properties for complete customization     |
| üì¶ **Plugin Architecture** | Extend with selection, filtering, grouping, and more |

## Installation

```bash
npm install @toolbox-web/grid
```

## Basic Usage

```html
<tbw-grid style="height: 400px;"></tbw-grid>

<script type="module">
  import '@toolbox-web/grid';

  const grid = document.querySelector('tbw-grid');
  grid.columns = [
    { field: 'id', header: 'ID', type: 'number' },
    { field: 'name', header: 'Name', sortable: true },
    { field: 'email', header: 'Email' },
  ];
  grid.rows = [
    { id: 1, name: 'Alice', email: 'alice@example.com' },
    { id: 2, name: 'Bob', email: 'bob@example.com' },
  ];
</script>
```

## Demos

### Interactive Playground

Experiment with all core grid options using the controls below. [Open with controls ‚Üí](?path=/story/grid-core--playground)

<Canvas of={GridStories.Playground} withToolbar />
<Controls of={GridStories.Playground} exclude={['fixedHeight']} />

### Column Inference

The grid can automatically infer column types from your data.

<Canvas of={GridStories.ColumnInference} withToolbar />

### Light DOM Columns

Define columns declaratively in HTML using `<tbw-grid-column>` elements.

<Canvas of={GridStories.LightDOMColumns} withToolbar />

### Custom Formatters

Use format functions and templates to customize cell display.

<Canvas of={GridStories.CustomFormatters} withToolbar />

### Dynamic Row & Cell Styling

Apply CSS classes dynamically based on row data or cell values using `rowClass` and `cellClass` callbacks.

#### Row Classes

Style entire rows based on data properties like status, role, or priority.

<Canvas of={GridStories.RowClass} withToolbar />

#### Cell Classes

Style individual cells based on their value - perfect for data validation or conditional formatting.

<Canvas of={GridStories.CellClass} withToolbar />

#### Combined Styling

Use both `rowClass` and `cellClass` together for comprehensive conditional styling.

<Canvas of={GridStories.CombinedDynamicClasses} withToolbar />

### Column State Persistence

Persist column widths, order, and visibility to localStorage.

<Canvas of={GridStories.ColumnStatePersistence} layout="fullscreen" withToolbar />

## Configuration

### Via Properties

```ts
const grid = document.querySelector('tbw-grid');
grid.columns = [...];
grid.rows = [...];
grid.fitMode = 'stretch'; // or 'fixed'
```

### Via gridConfig

```ts
grid.gridConfig = {
  columns: [...],
  fitMode: 'stretch',
  plugins: [new EditingPlugin({ editOn: 'dblclick' })], // or 'click'
};
grid.rows = [...];
```

## Column Configuration

| Property    | Type                                          | Description                |
| ----------- | --------------------------------------------- | -------------------------- |
| `field`     | `string`                                      | Data field name (required) |
| `header`    | `string`                                      | Column header text         |
| `type`      | `'string' \| 'number' \| 'boolean' \| 'date'` | Data type                  |
| `width`     | `number`                                      | Fixed width in pixels      |
| `minWidth`  | `number`                                      | Minimum width              |
| `maxWidth`  | `number`                                      | Maximum width              |
| `sortable`  | `boolean`                                     | Enable sorting             |
| `editable`  | `boolean`                                     | Enable editing             |
| `resizable` | `boolean`                                     | Enable resizing            |
| `format`    | `(value, row) => string`                      | Custom formatter           |
| `template`  | `string`                                      | Template string            |

## Keyboard Shortcuts

| Key                      | Action                       |
| ------------------------ | ---------------------------- |
| `‚Üë` `‚Üì` `‚Üê` `‚Üí`          | Navigate cells               |
| `Tab` / `Shift+Tab`      | Move to next/previous cell   |
| `Enter`                  | Start editing / confirm edit |
| `Escape`                 | Cancel editing               |
| `Home` / `End`           | Jump to first/last column    |
| `Ctrl+Home` / `Ctrl+End` | Jump to first/last row       |
| `Page Up` / `Page Down`  | Scroll by viewport           |

## Shell Components

The grid includes a shell wrapper for toolbar, tool panels, and status bar.

### Basic Shell

The shell provides a wrapper with toolbar, title, and optional tool panel sidebar. Use the controls to explore different configurations.

<Canvas of={GridStories.ShellBasic} withToolbar />

### Light DOM Shell Configuration

Configure the shell declaratively using `<tbw-grid-header>` elements. Set the title via attribute and add custom content with `<tbw-grid-header-content>`.

<Canvas of={GridStories.ShellLightDOMConfig} withToolbar />

### Multiple Tool Panels

Multiple plugins can register tool panels. The toolbar shows toggle buttons for each panel; clicking one opens it while closing any other open panel.

<Canvas of={GridStories.ShellMultiplePanels} withToolbar />

### Toolbar Buttons

Add custom toolbar buttons using the `<tbw-grid-tool-buttons>` container. Buttons are automatically styled and positioned in the toolbar.

<Canvas of={GridStories.ShellToolbarButtons} withToolbar />

## Events

| Event               | Detail                                       | Description                                     |
| ------------------- | -------------------------------------------- | ----------------------------------------------- |
| `cell-commit`       | `{ row, rowIndex, field, oldValue, newValue }` | Cell value committed (requires EditingPlugin)   |
| `row-commit`        | `{ row, rowIndex, changes }`                 | Row committed after bulk edit                   |
| `changed-rows-reset`| `{ changedRows }`                            | Changed rows tracking reset                     |
| `sort-change`       | `{ field, direction }`                       | Sort state changed (0=none, 1=asc, -1=desc)     |
| `column-resize`     | `{ field, width }`                           | Column width changed                            |
| `activate-cell`     | `{ rowIndex, colIndex }`                     | Cell activated via keyboard                     |
| `column-state-change` | `GridColumnState`                          | Column state (widths, order, visibility) changed |

## Methods

```ts
// Wait for grid to be ready
await grid.ready();

// Force layout recalculation
await grid.forceLayout();

// Get current configuration (readonly)
const config = await grid.getConfig();

// Column visibility
grid.setColumnVisible('fieldName', false);
grid.toggleColumnVisibility('fieldName');
const visible = grid.isColumnVisible('fieldName');

// Column state persistence
const state = grid.getColumnState();
grid.columnState = savedState;
grid.resetColumnState();

// Editing
await grid.beginBulkEdit(rowIndex);
await grid.commitActiveRowEdit();
await grid.cancelActiveRowEdit();
await grid.resetChangedRows();
```
