import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as ContextMenuStories from './context-menu.stories';

<Meta of={ContextMenuStories} />

# Context Menu Plugin

The Context Menu plugin adds a customizable right-click menu to your grid cells. Build anything from simple copy/paste actions to complex nested menus with conditional visibility, icons, and keyboard shortcuts.

## Installation

```ts
import { ContextMenuPlugin } from '@toolbox-web/grid/plugins/context-menu';
```

## Basic Usage

Define your menu items as an arrayâ€”each item has an `id`, `label`, and `action` callback that receives context about the clicked cell (row data, column info, cell value, etc.). Add separators between groups of actions for visual clarity.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'name', header: 'Name' },
    { field: 'email', header: 'Email' },
    { field: 'status', header: 'Status' }
  ],
  plugins: [
    new ContextMenuPlugin({
      items: [
        { id: 'copy', label: 'Copy Cell', action: (ctx) => navigator.clipboard.writeText(ctx.value) },
        { id: 'edit', label: 'Edit Row', action: (ctx) => grid.startEditing(ctx.rowIndex, ctx.colIndex) },
        { type: 'separator' },
        { id: 'delete', label: 'Delete Row', action: (ctx) => removeRow(ctx.rowIndex) },
      ],
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import { useRef, useEffect } from 'react';
import '@toolbox-web/grid';
import { ContextMenuPlugin } from '@toolbox-web/grid/plugins/context-menu';

function DataGrid({ data, onDelete }) {
  const gridRef = useRef(null);

  useEffect(() => {
    if (gridRef.current) {
      gridRef.current.gridConfig = {
        columns: [
          { field: 'name', header: 'Name' },
          { field: 'email', header: 'Email' },
          { field: 'status', header: 'Status' }
        ],
        plugins: [
          new ContextMenuPlugin({
            items: [
              { id: 'copy', label: 'Copy Cell', action: (ctx) => navigator.clipboard.writeText(ctx.value) },
              { id: 'edit', label: 'Edit Row', action: (ctx) => gridRef.current.startEditing(ctx.rowIndex, ctx.colIndex) },
              { type: 'separator' },
              { id: 'delete', label: 'Delete Row', action: (ctx) => onDelete(ctx.rowIndex) },
            ],
          }),
        ],
      };
      gridRef.current.rows = data;
    }
  }, [data]);

  return <tbw-grid ref={gridRef} />;
}
```
  </Tab>
  <Tab label="Vue">
```vue
<template>
  <tbw-grid ref="gridRef" />
</template>

<script setup>
import { ref, onMounted } from 'vue';
import '@toolbox-web/grid';
import { ContextMenuPlugin } from '@toolbox-web/grid/plugins/context-menu';

const props = defineProps(['data']);
const emit = defineEmits(['delete']);
const gridRef = ref(null);

onMounted(() => {
  gridRef.value.gridConfig = {
    columns: [
      { field: 'name', header: 'Name' },
      { field: 'email', header: 'Email' },
      { field: 'status', header: 'Status' }
    ],
    plugins: [
      new ContextMenuPlugin({
        items: [
          { id: 'copy', label: 'Copy Cell', action: (ctx) => navigator.clipboard.writeText(ctx.value) },
          { id: 'edit', label: 'Edit Row', action: (ctx) => gridRef.value.startEditing(ctx.rowIndex, ctx.colIndex) },
          { type: 'separator' },
          { id: 'delete', label: 'Delete Row', action: (ctx) => emit('delete', ctx.rowIndex) },
        ],
      }),
    ],
  };
  gridRef.value.rows = props.data;
});
</script>
```
  </Tab>
  <Tab label="Angular">
```typescript
import { Component, ElementRef, viewChild, effect, output, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import '@toolbox-web/grid';
import { ContextMenuPlugin } from '@toolbox-web/grid/plugins/context-menu';

@Component({
  standalone: true,
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `<tbw-grid #grid />`
})
export class DataGridComponent {
  gridRef = viewChild<ElementRef>('grid');
  deleteRow = output<number>();

  onGrid = effect(() => {
    const grid = this.gridRef()?.nativeElement;
    if (!grid) return;
    grid.gridConfig = {
      columns: [
        { field: 'name', header: 'Name' },
        { field: 'email', header: 'Email' },
        { field: 'status', header: 'Status' }
      ],
      plugins: [
        new ContextMenuPlugin({
          items: [
            { id: 'copy', label: 'Copy Cell', action: (ctx) => navigator.clipboard.writeText(ctx.value) },
            { id: 'edit', label: 'Edit Row', action: (ctx) => grid.startEditing(ctx.rowIndex, ctx.colIndex) },
            { type: 'separator' },
            { id: 'delete', label: 'Delete Row', action: (ctx) => this.deleteRow.emit(ctx.rowIndex) },
          ],
        }),
      ],
    };
  });
}
```
  </Tab>
</Tabs>

## Demos

### Default Context Menu

Right-click any cell to see the context menu.

<Canvas of={ContextMenuStories.Default} withToolbar />
<Controls of={ContextMenuStories.Default} />

### With Submenus

Nested menu items for complex actions.

<Canvas of={ContextMenuStories.WithSubmenus} withToolbar />

### Conditional Items

Show/hide items based on context.

<Canvas of={ContextMenuStories.ConditionalItems} withToolbar />

## Configuration Options

| Option  | Type         | Default | Description           |
| ------- | ------------ | ------- | --------------------- |
| `items` | `MenuItem[]` | `[]`    | Menu items to display |

## Menu Item Types

```ts
interface MenuItem {
  id: string;
  label: string;
  icon?: string; // Icon class or HTML
  action?: (ctx: MenuContext) => void;
  disabled?: boolean | ((ctx: MenuContext) => boolean);
  visible?: boolean | ((ctx: MenuContext) => boolean);
  items?: MenuItem[]; // Submenu items
}

interface SeparatorItem {
  type: 'separator';
}
```

## Menu Context

The action callback receives context about the clicked cell:

```ts
interface MenuContext {
  rowIndex: number;
  colIndex: number;
  field: string;
  value: any;
  row: any;
  column: ColumnConfig;
}
```

## Conditional Items

```ts
new ContextMenuPlugin({
  items: [
    {
      id: 'edit',
      label: 'Edit',
      visible: (ctx) => ctx.column.editable === true,
    },
    {
      id: 'delete',
      label: 'Delete',
      disabled: (ctx) => ctx.row.locked === true,
    },
  ],
});
```

## Events

| Event               | Detail              | Description |     |
| ------------------- | ------------------- | ----------- | --- |
| `context-menu-open` | `{ params, items }` | Menu opened |

## Styling

The context menu supports CSS custom properties for theming. Override these on `tbw-grid` or a parent container:

### CSS Custom Properties

| Property | Default | Description |
| --- | --- | --- |
| `--tbw-context-menu-bg` | `var(--tbw-color-panel-bg)` | Menu background |
| `--tbw-context-menu-fg` | `var(--tbw-color-fg)` | Menu text color |
| `--tbw-context-menu-border` | `var(--tbw-color-border)` | Menu border |
| `--tbw-context-menu-hover` | `var(--tbw-color-row-hover)` | Item hover background |
| `--tbw-menu-min-width` | `10rem` | Minimum menu width |
| `--tbw-menu-item-padding` | `0.375rem 0.75rem` | Menu item padding |
| `--tbw-menu-item-gap` | `0.5rem` | Gap between icon and label |
| `--tbw-font-size-sm` | `0.9285em` | Menu font size |
| `--tbw-font-size-xs` | `0.7857em` | Shortcut text size |
| `--tbw-icon-size` | `1em` | Icon width |

### Example

```css
tbw-grid {
  /* Custom context menu styling */
  --tbw-context-menu-bg: #2d2d2d;
  --tbw-context-menu-fg: #ffffff;
  --tbw-context-menu-border: #444444;
  --tbw-context-menu-hover: #3d3d3d;
  --tbw-menu-item-padding: 0.5rem 1rem;
}
```

### CSS Classes

The menu uses these class names for advanced customization:

| Class | Element |
| --- | --- |
| `.tbw-context-menu` | Menu container |
| `.tbw-context-menu-item` | Menu item row |
| `.tbw-context-menu-item.disabled` | Disabled item |
| `.tbw-context-menu-item.danger` | Danger/delete action |
| `.tbw-context-menu-icon` | Item icon container |
| `.tbw-context-menu-label` | Item label text |
| `.tbw-context-menu-shortcut` | Keyboard shortcut |
| `.tbw-context-menu-separator` | Divider line |
