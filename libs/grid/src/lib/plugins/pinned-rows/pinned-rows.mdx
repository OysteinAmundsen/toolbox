import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as PinnedRowsStories from './pinned-rows.stories';

<Meta of={PinnedRowsStories} />

# Pinned Rows (Status Bar) Plugin

The Pinned Rows plugin creates a fixed status bar at the top or bottom of the grid for displaying aggregations, row counts, or custom content. Think of it as the "totals row" you'd see in a spreadsheetâ€”always visible regardless of scroll position.

## Installation

```ts
import { PinnedRowsPlugin } from '@toolbox-web/grid/plugins/pinned-rows';
```

## Basic Usage

Configure aggregation rows with built-in functions (`sum`, `avg`, `count`, `min`, `max`) or custom aggregators. Each aggregation row can have different calculations per column.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'product', header: 'Product' },
    { field: 'quantity', header: 'Qty', type: 'number' },
    { field: 'price', header: 'Price', type: 'currency' },
  ],
  plugins: [
    new PinnedRowsPlugin({
      position: 'bottom',
      showRowCount: true,
      aggregationRows: [
        {
          id: 'totals',
          aggregators: {
            quantity: 'sum',
            price: { aggFunc: 'sum', formatter: (v) => `$${v.toFixed(2)}` },
          },
          cells: { product: 'Totals:' },
        },
      ],
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import '@toolbox-web/grid-react/features/pinned-rows';
import { DataGrid } from '@toolbox-web/grid-react';

function OrderGrid({ orders }) {
  return (
    <DataGrid
      rows={orders}
      columns={[
        { field: 'product', header: 'Product' },
        { field: 'quantity', header: 'Qty', type: 'number' },
        { field: 'price', header: 'Price', type: 'currency' },
      ]}
      pinnedRows={{
        position: 'bottom',
        showRowCount: true,
        aggregationRows: [
          {
            id: 'totals',
            aggregators: { quantity: 'sum', price: 'sum' },
            cells: { product: 'Totals:' },
          },
        ],
      }}
    />
  );
}
```
  </Tab>
  <Tab label="Vue">
```vue
<template>
  <tbw-grid ref="gridRef" />
</template>

<script setup>
import { ref, onMounted } from 'vue';
import '@toolbox-web/grid';
import { PinnedRowsPlugin } from '@toolbox-web/grid/plugins/pinned-rows';

const props = defineProps(['orders']);
const gridRef = ref(null);

onMounted(() => {
  gridRef.value.gridConfig = {
    columns: [
      { field: 'product', header: 'Product' },
      { field: 'quantity', header: 'Qty', type: 'number' },
      { field: 'price', header: 'Price', type: 'currency' },
    ],
    plugins: [
      new PinnedRowsPlugin({
        position: 'bottom',
        aggregationRows: [
          {
            id: 'totals',
            aggregators: { quantity: 'sum', price: 'sum' },
            cells: { product: 'Totals:' },
          },
        ],
      }),
    ],
  };
  gridRef.value.rows = props.orders;
});
</script>
```
  </Tab>
  <Tab label="Angular">
```typescript
import { Component, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { Grid } from '@toolbox-web/grid-angular';
import { PinnedRowsPlugin } from '@toolbox-web/grid/plugins/pinned-rows';
import type { GridConfig } from '@toolbox-web/grid';

@Component({
  selector: 'app-order-grid',
  imports: [Grid],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <tbw-grid
      [rows]="rows"
      [gridConfig]="config"
      style="height: 400px; display: block;">
    </tbw-grid>
  `,
})
export class OrderGridComponent {
  rows = [];

  config: GridConfig = {
    columns: [
      { field: 'product', header: 'Product' },
      { field: 'quantity', header: 'Qty', type: 'number' },
      { field: 'price', header: 'Price', type: 'currency' },
    ],
    plugins: [
      new PinnedRowsPlugin({
        position: 'bottom',
        showRowCount: true,
        aggregationRows: [
          {
            id: 'totals',
            aggregators: { quantity: 'sum', price: 'sum' },
            cells: { product: 'Totals:' },
          },
        ],
      }),
    ],
  };
}
```
  </Tab>
</Tabs>

## Demos

### Default Status Bar

<Canvas of={PinnedRowsStories.Default} withToolbar />
<Controls of={PinnedRowsStories.Default} />

### Multiple Aggregation Rows

<Canvas of={PinnedRowsStories.MultipleAggregations} withToolbar />

### Custom Panels

<Canvas of={PinnedRowsStories.CustomPanels} withToolbar />

## Configuration Options

| Option              | Type                     | Default    | Description                |
| ------------------- | ------------------------ | ---------- | -------------------------- |
| `position`          | `'top' \| 'bottom'`      | `'bottom'` | Status bar position        |
| `showRowCount`      | `boolean`                | `true`     | Display row count          |
| `showSelectedCount` | `boolean`                | `true`     | Display selected row count |
| `showFilteredCount` | `boolean`                | `true`     | Display filtered row count |
| `aggregationRows`   | `AggregationRowConfig[]` | `[]`       | Aggregation footer rows    |
| `customPanels`      | `PinnedRowsPanel[]`      | `[]`       | Custom info bar panels     |

## Aggregation Rows

Configure computed footer/header rows with aggregators:

```ts
new PinnedRowsPlugin({
  aggregationRows: [
    {
      id: 'totals',
      position: 'bottom',
      aggregators: {
        // Simple string aggregator
        quantity: 'sum',
        // Object syntax with formatter
        price: {
          aggFunc: 'sum',
          formatter: (value) => `$${value.toFixed(2)}`,
        },
      },
      cells: { id: 'Totals:', name: '' },
    },
  ],
});
```

### Aggregator Syntax

| Syntax   | Example                                              | Description                |
| -------- | ---------------------------------------------------- | -------------------------- |
| String   | `'sum'`                                              | Built-in aggregator        |
| Function | `(rows, field) => rows.length`                       | Custom aggregator function |
| Object   | `{ aggFunc: 'sum', formatter: (v) => v.toFixed(2) }` | Aggregator with formatter  |

### Built-in Aggregators

`sum`, `avg`, `count`, `min`, `max`, `first`, `last`

## Custom Panels

```ts
new PinnedRowsPlugin({
  customPanels: [
    {
      id: 'info',
      position: 'right',
      render: (ctx) => `<span>Rows: ${ctx.totalRows}</span>`,
    },
  ],
});
```
