import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as ClipboardStories from './clipboard.stories';

<Meta of={ClipboardStories} />

# Clipboard Plugin

The Clipboard plugin brings familiar copy/cut/paste functionality to your grid with full keyboard shortcut support (Ctrl+C, Ctrl+X, Ctrl+V). It handles single cells, multi-cell selections, and integrates seamlessly with Excel and other spreadsheet applications via tab-delimited output.

> ðŸ’¡ **Optional Dependency:** Works best with [SelectionPlugin](/docs/grid-plugins-selection--docs) for copying/pasting selected cells. Without SelectionPlugin, copies the entire grid and pastes at row 0, column 0.

## Installation

```ts
import { ClipboardPlugin } from '@toolbox-web/grid/plugins/clipboard';
```

## Basic Usage

Just add the plugin and you're ready to goâ€”keyboard shortcuts work automatically. Configure options like `includeHeaders` for copying column headers or `delimiter` for custom CSV formats.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'name', header: 'Name' },
    { field: 'email', header: 'Email' },
    { field: 'department', header: 'Department' }
  ],
  plugins: [
    new ClipboardPlugin({
      includeHeaders: true,
      quoteStrings: true, // Wrap text in quotes for CSV compatibility
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import { useRef, useEffect } from 'react';
import '@toolbox-web/grid';
import { ClipboardPlugin } from '@toolbox-web/grid/plugins/clipboard';

function DataGrid({ data }) {
  const gridRef = useRef(null);

  useEffect(() => {
    if (gridRef.current) {
      gridRef.current.gridConfig = {
        columns: [
          { field: 'name', header: 'Name' },
          { field: 'email', header: 'Email' },
          { field: 'department', header: 'Department' }
        ],
        plugins: [
          new ClipboardPlugin({
            includeHeaders: true,
            quoteStrings: true,
          }),
        ],
      };
      gridRef.current.rows = data;
    }
  }, [data]);

  return <tbw-grid ref={gridRef} />;
}
```
  </Tab>
  <Tab label="Vue">
```vue
<template>
  <tbw-grid ref="gridRef" />
</template>

<script setup>
import { ref, onMounted } from 'vue';
import '@toolbox-web/grid';
import { ClipboardPlugin } from '@toolbox-web/grid/plugins/clipboard';

const props = defineProps(['data']);
const gridRef = ref(null);

onMounted(() => {
  gridRef.value.gridConfig = {
    columns: [
      { field: 'name', header: 'Name' },
      { field: 'email', header: 'Email' },
      { field: 'department', header: 'Department' }
    ],
    plugins: [
      new ClipboardPlugin({
        includeHeaders: true,
        quoteStrings: true,
      }),
    ],
  };
  gridRef.value.rows = props.data;
});
</script>
```
  </Tab>
  <Tab label="Angular">
```typescript
import { Component, ElementRef, viewChild, effect, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import '@toolbox-web/grid';
import { ClipboardPlugin } from '@toolbox-web/grid/plugins/clipboard';

@Component({
  standalone: true,
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `<tbw-grid #grid />`
})
export class DataGridComponent {
  gridRef = viewChild<ElementRef>('grid');

  onGrid = effect(() => {
    this.gridRef()?.nativeElement.gridConfig = {
      columns: [
        { field: 'name', header: 'Name' },
        { field: 'email', header: 'Email' },
        { field: 'department', header: 'Department' }
      ],
      plugins: [
        new ClipboardPlugin({
          includeHeaders: true,
          quoteStrings: true,
        }),
      ],
    };
  });
}
```
  </Tab>
</Tabs>

## Demos

### Default Clipboard

Select cells and use Ctrl+C to copy, Ctrl+V to paste.

<Canvas of={ClipboardStories.Default} withToolbar />
<Controls of={ClipboardStories.Default} />

### With Headers

Include column headers when copying.

<Canvas of={ClipboardStories.WithHeaders} withToolbar />

### Quoted Strings

Wrap text values in quotes for CSV compatibility.

<Canvas of={ClipboardStories.QuotedStrings} withToolbar />

### Copy & Paste (Auto-Paste)

By default, the ClipboardPlugin handles paste operations automaticallyâ€”no event handling needed.
Just add the plugin and paste works out of the box.

<Canvas of={ClipboardStories.CopyPaste} withToolbar />

### Custom Paste Handler

For advanced use cases, provide a custom `pasteHandler` to validate, transform, or integrate with state management.

<Canvas of={ClipboardStories.CustomPasteHandler} withToolbar />

## Configuration Options

| Option           | Type                                  | Default              | Description                                                                                              |
| ---------------- | ------------------------------------- | -------------------- | -------------------------------------------------------------------------------------------------------- |
| `includeHeaders` | `boolean`                             | `false`              | Include column headers in copied data                                                                    |
| `delimiter`      | `string`                              | `'\t'`               | Column delimiter (tab for Excel compatibility)                                                           |
| `newline`        | `string`                              | `'\n'`               | Row delimiter                                                                                            |
| `quoteStrings`   | `boolean`                             | `false`              | Wrap string values in quotes                                                                             |
| `processCell`    | `(value, field, row) => string`       | -                    | Custom cell value processor for copy operations                                                          |
| `pasteHandler`   | `PasteHandler \| null`                | `defaultPasteHandler`| Custom paste handler. Set to `null` to disable auto-paste and handle the `paste` event manually         |

## Paste Behavior

The clipboard plugin respects both selection bounds and the `editable` column property when pasting:

### Editable Columns

**Paste only works on columns marked `editable: true`.** Non-editable columns are skipped during paste, preserving column alignment:

```ts
columns: [
  { field: 'id', header: 'ID' },                    // NOT editable - paste skipped
  { field: 'name', header: 'Name', editable: true }, // Paste allowed
  { field: 'email', header: 'Email', editable: true }, // Paste allowed
]
```

If you paste `"1\t2\t3"` into this grid, only the `name` and `email` columns receive values (`2` and `3`). The `id` column remains unchanged.

> ðŸ’¡ **Tip:** This works independently of the EditingPlugin. You can use `editable: true` to control paste behavior even without enabling inline editing.

### Selection Bounds

| Selection Type  | Paste Behavior                                                                 |
| --------------- | ------------------------------------------------------------------------------ |
| Single cell     | Paste expands freely from that cell, adding rows if needed                     |
| Range selection | Paste is clipped to fit within the selected range                              |
| Row selection   | Paste is clipped to the selected rows (all columns within those rows)          |
| No selection    | Paste starts at row 0, column 0                                                |

**Example:** If you have a 2Ã—2 range selected and paste 3Ã—3 data, only the 2Ã—2 portion that fits will be applied.

## Keyboard Shortcuts

| Shortcut           | Action                    |
| ------------------ | ------------------------- |
| `Ctrl+C` / `Cmd+C` | Copy selected cells       |
| `Ctrl+V` / `Cmd+V` | Paste into selected cells |
| `Ctrl+X` / `Cmd+X` | Cut selected cells        |

## Programmatic API

```ts
const plugin = grid.getPlugin(ClipboardPlugin);

// Copy selection to clipboard
await plugin.copy();

// Copy with custom options
await plugin.copy({ includeHeaders: true });

// Paste from clipboard
await plugin.paste();

// Get clipboard text without copying
const text = plugin.getSelectionAsText();
```

## Excel Compatibility

The default tab delimiter ensures copied data pastes correctly into Excel:

```ts
new ClipboardPlugin({
  delimiter: '\t', // Tab for Excel
  includeHeaders: true, // Include column names
});
```

## Styling

The clipboard plugin doesn't add visible UI elements. Selection styling is handled by the SelectionPlugin.
