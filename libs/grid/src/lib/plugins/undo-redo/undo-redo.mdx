import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as UndoRedoStories from './undo-redo.stories';

<Meta of={UndoRedoStories} />

# Undo/Redo Plugin

The Undo/Redo plugin tracks all cell edits and lets users revert or replay changes with familiar keyboard shortcuts (Ctrl+Z / Ctrl+Y). It maintains an in-memory history stack with configurable depth—perfect for data entry workflows where mistakes happen.

> ⚠️ **Required Dependency:** This plugin requires [EditingPlugin](/docs/grid-plugins-editing--docs) to be loaded first. UndoRedo tracks the edit history that EditingPlugin creates.

## Installation

```ts
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';
import { UndoRedoPlugin } from '@toolbox-web/grid/plugins/undo-redo';
```

## Basic Usage

Add the plugin along with `EditingPlugin` to any grid with editable columns. History tracking is automatic—every cell edit is recorded, and users can navigate back and forth through the edit history.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'name', header: 'Name', editable: true },
    { field: 'price', header: 'Price', type: 'number', editable: true },
    { field: 'quantity', header: 'Quantity', type: 'number', editable: true },
  ],
  plugins: [
    new EditingPlugin({ editOn: 'dblclick' }),
    new UndoRedoPlugin({
      maxHistorySize: 50, // Remember last 50 edits
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import '@toolbox-web/grid-react/features/editing';
import '@toolbox-web/grid-react/features/undo-redo';
import { DataGrid } from '@toolbox-web/grid-react';

function MyGrid({ data }) {
  return (
    <DataGrid
      rows={data}
      columns={[
        { field: 'name', header: 'Name', editable: true },
        { field: 'price', header: 'Price', type: 'number', editable: true },
        { field: 'quantity', header: 'Quantity', type: 'number', editable: true },
      ]}
      editing={{ editOn: 'dblclick' }}
      undoRedo={{ maxHistorySize: 50 }}
    />
  );
}
```
  </Tab>
  <Tab label="Vue">
```vue
<template>
  <tbw-grid ref="gridRef" />
</template>

<script setup>
import { ref, onMounted } from 'vue';
import '@toolbox-web/grid';
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';
import { UndoRedoPlugin } from '@toolbox-web/grid/plugins/undo-redo';

const props = defineProps(['data']);
const gridRef = ref(null);

onMounted(() => {
  gridRef.value.gridConfig = {
    columns: [
      { field: 'name', header: 'Name', editable: true },
      { field: 'price', header: 'Price', type: 'number', editable: true },
      { field: 'quantity', header: 'Quantity', type: 'number', editable: true },
    ],
    plugins: [
      new EditingPlugin({ editOn: 'dblclick' }),
      new UndoRedoPlugin({ maxHistorySize: 50 }),
    ],
  };
  gridRef.value.rows = props.data;
});
</script>
```
  </Tab>
  <Tab label="Angular">
```typescript
import { Component, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { Grid } from '@toolbox-web/grid-angular';
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';
import { UndoRedoPlugin } from '@toolbox-web/grid/plugins/undo-redo';
import type { GridConfig } from '@toolbox-web/grid';

@Component({
  selector: 'app-my-grid',
  imports: [Grid],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <tbw-grid
      [rows]="rows"
      [gridConfig]="config"
      style="height: 400px; display: block;">
    </tbw-grid>
  `,
})
export class MyGridComponent {
  rows = [...];

  config: GridConfig = {
    columns: [
      { field: 'name', header: 'Name', editable: true },
      { field: 'price', header: 'Price', type: 'number', editable: true },
      { field: 'quantity', header: 'Quantity', type: 'number', editable: true },
    ],
    plugins: [
      new EditingPlugin({ editOn: 'dblclick' }),
      new UndoRedoPlugin({ maxHistorySize: 50 }),
    ],
  };
}
```
  </Tab>
</Tabs>

## Demos

### Default Undo/Redo

<Canvas of={UndoRedoStories.Default} withToolbar />
<Controls of={UndoRedoStories.Default} />

### Limited History

<Canvas of={UndoRedoStories.LimitedHistory} withToolbar />

## Configuration Options

| Option           | Type     | Default | Description            |
| ---------------- | -------- | ------- | ---------------------- |
| `maxHistorySize` | `number` | `100`   | Max actions in history |

## Keyboard Shortcuts

| Shortcut                 | Action |
| ------------------------ | ------ |
| `Ctrl+Z` / `Cmd+Z`       | Undo   |
| `Ctrl+Y` / `Cmd+Shift+Z` | Redo   |

## Programmatic API

```ts
const plugin = grid.getPlugin(UndoRedoPlugin);

plugin.undo();
plugin.redo();
const canUndo = plugin.canUndo();
const canRedo = plugin.canRedo();
plugin.clearHistory();
```
