import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../docs/components/Tabs';
import * as MasterDetailStories from './master-detail.stories';

<Meta of={MasterDetailStories} />

# Master-Detail Plugin

The Master-Detail plugin lets you create expandable detail rows that reveal additional content beneath each master row. Perfect for order/line-item UIs, employee/department views, or any scenario where you need to show related data without navigating away.

## Installation

```ts
import { MasterDetailPlugin } from '@toolbox-web/grid/plugins/master-detail';
```

## Basic Usage

The key configuration is `detailRenderer` - a function that receives the row data and returns either an HTML string or a DOM element. This gives you complete control over what appears in the expanded detail area.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'orderId', header: 'Order ID' },
    { field: 'customer', header: 'Customer' },
    { field: 'total', header: 'Total', type: 'currency' }
  ],
  plugins: [
    new MasterDetailPlugin({
      detailRenderer: (row) => `
        <div class="order-details">
          <h4>Order Items</h4>
          <ul>
            ${row.items.map(item => `<li>${item.name} - $${item.price}</li>`).join('')}
          </ul>
        </div>
      `,
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import { useRef, useEffect } from 'react';
import '@toolbox-web/grid';
import { MasterDetailPlugin } from '@toolbox-web/grid/plugins/master-detail';

function OrderGrid({ orders }) {
  const gridRef = useRef(null);

  useEffect(() => {
    if (gridRef.current) {
      gridRef.current.gridConfig = {
        columns: [
          { field: 'orderId', header: 'Order ID' },
          { field: 'customer', header: 'Customer' },
          { field: 'total', header: 'Total', type: 'currency' }
        ],
        plugins: [
          new MasterDetailPlugin({
            detailRenderer: (row) => `
              <div class="order-details">
                <h4>Order Items</h4>
                <ul>
                  ${row.items.map(item => `<li>${item.name} - $${item.price}</li>`).join('')}
                </ul>
              </div>
            `,
          }),
        ],
      };
      gridRef.current.rows = orders;
    }
  }, [orders]);

  return <tbw-grid ref={gridRef} />;
}
```
  </Tab>
  <Tab label="Vue">
```vue
<template>
  <tbw-grid ref="gridRef" />
</template>

<script setup>
import { ref, onMounted, watch } from 'vue';
import '@toolbox-web/grid';
import { MasterDetailPlugin } from '@toolbox-web/grid/plugins/master-detail';

const props = defineProps(['orders']);
const gridRef = ref(null);

onMounted(() => {
  gridRef.value.gridConfig = {
    columns: [
      { field: 'orderId', header: 'Order ID' },
      { field: 'customer', header: 'Customer' },
      { field: 'total', header: 'Total', type: 'currency' }
    ],
    plugins: [
      new MasterDetailPlugin({
        detailRenderer: (row) => `
          <div class="order-details">
            <h4>Order Items</h4>
            <ul>
              ${row.items.map(item => `<li>${item.name} - $${item.price}</li>`).join('')}
            </ul>
          </div>
        `,
      }),
    ],
  };
  gridRef.value.rows = props.orders;
});
</script>
```
  </Tab>
  <Tab label="Angular">
```typescript
import { Component, ElementRef, ViewChild, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import '@toolbox-web/grid';
import { MasterDetailPlugin } from '@toolbox-web/grid/plugins/master-detail';

@Component({
  standalone: true,
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `<tbw-grid #grid />`
})
export class OrderGridComponent {
  @ViewChild('grid') gridRef!: ElementRef;

  ngAfterViewInit() {
    this.gridRef.nativeElement.gridConfig = {
      columns: [
        { field: 'orderId', header: 'Order ID' },
        { field: 'customer', header: 'Customer' },
        { field: 'total', header: 'Total', type: 'currency' }
      ],
      plugins: [
        new MasterDetailPlugin({
          detailRenderer: (row) => `
            <div class="order-details">
              <h4>Order Items</h4>
              <ul>
                ${row.items.map(item => `<li>${item.name} - $${item.price}</li>`).join('')}
              </ul>
            </div>
          `,
        }),
      ],
    };
  }
}
```
  </Tab>
</Tabs>

## Demos

### Default Master-Detail

<Canvas of={MasterDetailStories.Default} withToolbar />
<Controls of={MasterDetailStories.Default} />

### Expand on Row Click

<Canvas of={MasterDetailStories.ExpandOnRowClick} withToolbar />

### Fixed Detail Height

<Canvas of={MasterDetailStories.FixedDetailHeight} withToolbar />

## Configuration Options

| Option                   | Type                             | Default   | Description                                      |
| ------------------------ | -------------------------------- | --------- | ------------------------------------------------ |
| `detailRenderer`         | `(row) => HTMLElement \| string` | required  | Render function                                  |
| `expandOnRowClick`       | `boolean`                        | `false`   | Expand on row click                              |
| `detailHeight`           | `number \| 'auto'`               | `'auto'`  | Detail row height                                |
| `collapseOnClickOutside` | `boolean`                        | `false`   | Collapse on click outside                        |
| `showExpandColumn`       | `boolean`                        | `true`    | Show expand/collapse column                      |
| `animation`              | `false \| 'slide' \| 'fade'`     | `'slide'` | Animation style for expanding/collapsing details |

### Animation Options

The `animation` option controls how detail rows appear/disappear:

```ts
// Slide animation (default)
new MasterDetailPlugin({ animation: 'slide', ... });

// Fade animation
new MasterDetailPlugin({ animation: 'fade', ... });

// No animation
new MasterDetailPlugin({ animation: false, ... });
```

> **Note:** Animation respects the grid-level `animation.mode` setting. If the grid has `animation: { mode: 'off' }`, plugin animations are disabled.

## Nested Grid Example

```ts
new MasterDetailPlugin({
  detailRenderer: (row) => {
    const childGrid = document.createElement('tbw-grid');
    childGrid.style.height = '200px';
    childGrid.gridConfig = { columns: [...] };
    childGrid.rows = row.items || [];
    return childGrid;
  },
})
```

## Programmatic API

```ts
const plugin = grid.getPlugin(MasterDetailPlugin);

plugin.expandRow(rowIndex);
plugin.collapseRow(rowIndex);
plugin.toggleRow(rowIndex);
plugin.expandAll();
plugin.collapseAll();
const isExpanded = plugin.isRowExpanded(rowIndex);
```
