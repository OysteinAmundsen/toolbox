import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as UndoRedoStories from './undo-redo.stories';

<Meta of={UndoRedoStories} />

# Undo/Redo Plugin

The Undo/Redo plugin tracks all cell edits and lets users revert or replay changes with familiar keyboard shortcuts (Ctrl+Z / Ctrl+Y). It maintains an in-memory history stack with configurable depth—perfect for data entry workflows where mistakes happen.

> ⚠️ **Required Dependency:** This plugin requires [EditingPlugin](/docs/grid-plugins-editing--docs) to be loaded first. UndoRedo tracks the edit history that EditingPlugin creates.

## Installation

```ts
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';
import { UndoRedoPlugin } from '@toolbox-web/grid/plugins/undo-redo';
```

## Basic Usage

Add the plugin along with `EditingPlugin` to any grid with editable columns. History tracking is automatic—every cell edit is recorded, and users can navigate back and forth through the edit history.

<Tabs>
  <Tab label="Vanilla JS">
```ts
import { queryGrid } from '@toolbox-web/grid';

const grid = queryGrid('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'name', header: 'Name', editable: true },
    { field: 'price', header: 'Price', type: 'number', editable: true },
    { field: 'quantity', header: 'Quantity', type: 'number', editable: true },
  ],
  plugins: [
    new EditingPlugin({ editOn: 'dblclick' }),
    new UndoRedoPlugin({
      maxHistorySize: 50, // Remember last 50 edits
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import '@toolbox-web/grid-react/features/editing';
import '@toolbox-web/grid-react/features/undo-redo';
import { DataGrid } from '@toolbox-web/grid-react';

function MyGrid({ data }) {
  return (
    <DataGrid
      rows={data}
      columns={[
        { field: 'name', header: 'Name', editable: true },
        { field: 'price', header: 'Price', type: 'number', editable: true },
        { field: 'quantity', header: 'Quantity', type: 'number', editable: true },
      ]}
      editing={{ editOn: 'dblclick' }}
      undoRedo={{ maxHistorySize: 50 }}
    />
  );
}
```
  </Tab>
  <Tab label="Vue">
```html
<script setup>
import '@toolbox-web/grid-vue/features/editing';
import '@toolbox-web/grid-vue/features/undo-redo';
import { TbwGrid, TbwGridColumn } from '@toolbox-web/grid-vue';

const data = [
  { name: 'Widget', price: 9.99, quantity: 10 },
  { name: 'Gadget', price: 19.99, quantity: 5 },
];
</script>

<template>
  <TbwGrid
    :rows="data"
    editing="dblclick"
    :undo-redo="{ maxHistorySize: 50 }"
  >
    <TbwGridColumn field="name" header="Name" editable />
    <TbwGridColumn field="price" header="Price" type="number" editable />
    <TbwGridColumn field="quantity" header="Quantity" type="number" editable />
  </TbwGrid>
</template>
```
  </Tab>
  <Tab label="Angular">
```typescript
// Feature imports - enable the [editing] and [undoRedo] inputs
import '@toolbox-web/grid-angular/features/editing';
import '@toolbox-web/grid-angular/features/undo-redo';

import { Component } from '@angular/core';
import { Grid } from '@toolbox-web/grid-angular';
import type { ColumnConfig } from '@toolbox-web/grid';

@Component({
  selector: 'app-my-grid',
  imports: [Grid],
  template: `
    <tbw-grid
      [rows]="rows"
      [columns]="columns"
      [editing]="true"
      [undoRedo]="{ maxHistorySize: 50 }"
      style="height: 400px; display: block;">
    </tbw-grid>
  `,
})
export class MyGridComponent {
  rows = [...];

  columns: ColumnConfig[] = [
    { field: 'name', header: 'Name', editable: true },
    { field: 'price', header: 'Price', type: 'number', editable: true },
    { field: 'quantity', header: 'Quantity', type: 'number', editable: true },
  ];
}
```
  </Tab>
</Tabs>

## Demos

### Default Undo/Redo

<Canvas of={UndoRedoStories.Default} withToolbar />
<Controls of={UndoRedoStories.Default} />

### Limited History

<Canvas of={UndoRedoStories.LimitedHistory} withToolbar />

## Configuration Options

| Option           | Type     | Default | Description            |
| ---------------- | -------- | ------- | ---------------------- |
| `maxHistorySize` | `number` | `100`   | Max actions in history |

## Keyboard Shortcuts

| Shortcut                 | Action |
| ------------------------ | ------ |
| `Ctrl+Z` / `Cmd+Z`       | Undo   |
| `Ctrl+Y` / `Cmd+Shift+Z` | Redo   |

## Programmatic API

```ts
const plugin = grid.getPlugin(UndoRedoPlugin);

plugin.undo();
plugin.redo();
const canUndo = plugin.canUndo();
const canRedo = plugin.canRedo();
plugin.clearHistory();
```

## See Also

- **[Editing](../?path=/docs/grid-plugins-editing--docs)** — Inline cell editing (required)
- **[Clipboard](../?path=/docs/grid-plugins-clipboard--docs)** — Copy/paste cells
