{/* AI-CONTEXT: For structured, AI-optimized documentation about this plugin,
    see https://raw.githubusercontent.com/OysteinAmundsen/toolbox/main/llms-full.txt
    — section: "### MasterDetailPlugin" (under "## Plugin Configuration Reference") */}
import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as MasterDetailStories from './master-detail.stories';

<Meta of={MasterDetailStories} />

# Master-Detail Plugin

The Master-Detail plugin lets you create expandable detail rows that reveal additional content beneath each master row. Perfect for order/line-item UIs, employee/department views, or any scenario where you need to show related data without navigating away.

## Installation

```ts
import { MasterDetailPlugin } from '@toolbox-web/grid/plugins/master-detail';
```

## Basic Usage

The key configuration is `detailRenderer` - a function that receives the row data and returns either an HTML string or a DOM element. This gives you complete control over what appears in the expanded detail area.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'orderId', header: 'Order ID' },
    { field: 'customer', header: 'Customer' },
    { field: 'total', header: 'Total', type: 'currency' }
  ],
  plugins: [
    new MasterDetailPlugin({
      detailRenderer: (row) => `
        <div class="order-details">
          <h4>Order Items</h4>
          <ul>
            ${row.items.map(item => `<li>${item.name} - $${item.price}</li>`).join('')}
          </ul>
        </div>
      `,
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import '@toolbox-web/grid-react/features/master-detail';
import { DataGrid, GridDetailPanel } from '@toolbox-web/grid-react';

function OrderGrid({ orders }) {
  return (
    <DataGrid
      rows={orders}
      columns={[
        { field: 'orderId', header: 'Order ID' },
        { field: 'customer', header: 'Customer' },
        { field: 'total', header: 'Total', type: 'currency' }
      ]}
      masterDetail
    >
      <GridDetailPanel>
        {({ row }) => (
          <div className="order-details">
            <h4>Order Items</h4>
            <ul>
              {row.items.map(item => (
                <li key={item.id}>{item.name} - ${item.price}</li>
              ))}
            </ul>
          </div>
        )}
      </GridDetailPanel>
    </DataGrid>
  );
}
```
  </Tab>
  <Tab label="Vue">
```html
<script setup>
import '@toolbox-web/grid-vue/features/master-detail';
import { TbwGrid, TbwGridColumn, TbwGridDetailPanel } from '@toolbox-web/grid-vue';

const orders = [
  { orderId: 'ORD-001', customer: 'Alice', total: 150, items: [{ id: 1, name: 'Widget', price: 50 }, { id: 2, name: 'Gadget', price: 100 }] },
  { orderId: 'ORD-002', customer: 'Bob', total: 75, items: [{ id: 3, name: 'Tool', price: 75 }] },
];
</script>

<template>
  <TbwGrid :rows="orders" master-detail>
    <TbwGridColumn field="orderId" header="Order ID" />
    <TbwGridColumn field="customer" header="Customer" />
    <TbwGridColumn field="total" header="Total" type="currency" />

    <TbwGridDetailPanel v-slot="{ row }">
      <div class="order-details">
        <h4>Order Items</h4>
        <ul>
          <li v-for="item in row.items" :key="item.id">
            {{ item.name }} - ${{ item.price }}
          </li>
        </ul>
      </div>
    </TbwGridDetailPanel>
  </TbwGrid>
</template>
```
  </Tab>
  <Tab label="Angular">
```typescript
// Feature import - enables the [masterDetail] input
import '@toolbox-web/grid-angular/features/master-detail';

import { Component } from '@angular/core';
import { Grid } from '@toolbox-web/grid-angular';
import type { ColumnConfig } from '@toolbox-web/grid';

@Component({
  selector: 'app-order-grid',
  imports: [Grid],
  template: `
    <tbw-grid
      [rows]="orders"
      [columns]="columns"
      [masterDetail]="masterDetailConfig"
      style="height: 400px; display: block;">
    </tbw-grid>
  `,
})
export class OrderGridComponent {
  orders = [/* order data */];

  columns: ColumnConfig[] = [
    { field: 'orderId', header: 'Order ID' },
    { field: 'customer', header: 'Customer' },
    { field: 'total', header: 'Total', type: 'currency' }
  ];

  masterDetailConfig = {
    detailRenderer: (row: any) => `
      <div class="order-details">
        <h4>Order Items</h4>
        <ul>
          ${row.items.map((item: any) => `<li>${item.name} - $${item.price}</li>`).join('')}
        </ul>
      </div>
    `,
  };
}
```
  </Tab>
</Tabs>

## Demos

### Default Master-Detail

<Canvas of={MasterDetailStories.Default} withToolbar />
<Controls of={MasterDetailStories.Default} />

### Expand on Row Click

<Canvas of={MasterDetailStories.ExpandOnRowClick} withToolbar />

### Fixed Detail Height

<Canvas of={MasterDetailStories.FixedDetailHeight} withToolbar />

## Configuration Options

| Option                   | Type                             | Default   | Description                                      |
| ------------------------ | -------------------------------- | --------- | ------------------------------------------------ |
| `detailRenderer`         | `(row) => HTMLElement \| string` | required  | Render function                                  |
| `expandOnRowClick`       | `boolean`                        | `false`   | Expand on row click                              |
| `detailHeight`           | `number \| 'auto'`               | `'auto'`  | Detail row height                                |
| `collapseOnClickOutside` | `boolean`                        | `false`   | Collapse on click outside                        |
| `showExpandColumn`       | `boolean`                        | `true`    | Show expand/collapse column                      |
| `animation`              | `false \| 'slide' \| 'fade'`     | `'slide'` | Animation style for expanding/collapsing details |

### Animation Options

The `animation` option controls how detail rows appear/disappear:

```ts
// Slide animation (default)
new MasterDetailPlugin({ animation: 'slide', ... });

// Fade animation
new MasterDetailPlugin({ animation: 'fade', ... });

// No animation
new MasterDetailPlugin({ animation: false, ... });
```

> **Note:** Animation respects the grid-level `animation.mode` setting. If the grid has `animation: { mode: 'off' }`, plugin animations are disabled.

## Nested Grid Example

```ts
new MasterDetailPlugin({
  detailRenderer: (row) => {
    const childGrid = document.createElement('tbw-grid');
    childGrid.style.height = '200px';
    childGrid.gridConfig = { columns: [...] };
    childGrid.rows = row.items || [];
    return childGrid;
  },
})
```

## Programmatic API

```ts
const plugin = grid.getPlugin(MasterDetailPlugin);

plugin.expandRow(rowIndex);
plugin.collapseRow(rowIndex);
plugin.toggleRow(rowIndex);
plugin.expandAll();
plugin.collapseAll();
const isExpanded = plugin.isRowExpanded(rowIndex);
```

## Styling

The master-detail plugin supports CSS custom properties for theming. Override these on `tbw-grid` or a parent container:

### CSS Custom Properties

| Property | Default | Description |
| --- | --- | --- |
| `--tbw-master-detail-bg` | `var(--tbw-color-row-alt)` | Detail row background |
| `--tbw-master-detail-border` | `var(--tbw-color-border)` | Detail row border |
| `--tbw-detail-padding` | `1em` | Detail content padding |
| `--tbw-detail-max-height` | `31.25rem` (~500px) | Max height for animation |
| `--tbw-animation-duration` | `200ms` | Expand/collapse animation |
| `--tbw-animation-easing` | `ease-out` | Animation curve |

### Example

```css
tbw-grid {
  /* Custom master-detail styling */
  --tbw-master-detail-bg: #f8f9fa;
  --tbw-master-detail-border: #dee2e6;
  --tbw-detail-padding: 1.5rem;
  --tbw-animation-duration: 300ms;
}
```

### CSS Classes

The master-detail plugin uses these class names:

| Class | Element |
| --- | --- |
| `.master-detail-expander` | Expander cell container |
| `.master-detail-toggle` | Expand/collapse icon |
| `.master-detail-row` | Detail row container |
| `.master-detail-row.tbw-expanding` | Row during expand animation |
| `.master-detail-row.tbw-collapsing` | Row during collapse animation |
| `.master-detail-cell` | Detail content wrapper |

## See Also

- **[Tree](../?path=/docs/grid-plugins-tree--docs)** — Hierarchical tree data
- **[Row Grouping](../?path=/docs/grid-plugins-row-grouping--docs)** — Group rows by field values
- **[Selection](../?path=/docs/grid-plugins-selection--docs)** — Row and cell selection
