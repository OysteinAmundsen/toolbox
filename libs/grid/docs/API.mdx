{/* API.mdx */}
import { Meta, ArgTypes } from '@storybook/addon-docs/blocks';

<Meta title="Grid/API" />

# API Reference

Complete reference for the `<tbw-grid>` component API.

## Element Tag

```html
<tbw-grid></tbw-grid>
```

The custom element is registered as `tbw-grid` (Toolbox Web Grid).

## Properties

### Core Data Properties

| Property     | Type             | Default | Description                |
| ------------ | ---------------- | ------- | -------------------------- |
| `rows`       | `T[]`            | `[]`    | Array of row data objects  |
| `columns`    | [`ColumnConfig`](/docs/grid-api-core-interfaces-columnconfig--docs)`[]` | `[]`    | Column configuration array |
| `gridConfig` | [`GridConfig`](/docs/grid-api-core-interfaces-gridconfig--docs)`<T>`  | `{}`    | Full configuration object  |

### Layout Properties

| Property  | Type                   | Default     | Description            |
| --------- | ---------------------- | ----------- | ---------------------- |
| `fitMode` | `'stretch' \| 'fixed'` | `'stretch'` | Column sizing strategy |

### Read-only Properties

| Property      | Type                      | Description                   |
| ------------- | ------------------------- | ----------------------------- |
| `changedRows` | `T[]`                     | Rows with pending edits (requires EditingPlugin) |
| `sortState`   | `Map<string,` [`SortState`](/docs/grid-api-core-interfaces-sortstate--docs)`>`  | Current sort state per column |

## Declarative Configuration

The grid supports two forms of declarative HTML configuration:

1. **HTML Attributes** ‚Äî JSON-serialized values on the `<tbw-grid>` element itself
2. **Light DOM Elements** ‚Äî Child elements nested inside `<tbw-grid>` for more readable markup

Both approaches can be combined. Light DOM elements take precedence over JSON attributes for the same configuration (e.g., `<tbw-grid-column>` elements override the `columns` attribute).

> **Note:** JavaScript property assignment always takes precedence over declarative configuration. Removing an attribute or element does not clear a JS-set value.

### HTML Attributes

Attributes on the `<tbw-grid>` element for simple or programmatically-generated configuration:

| Attribute     | Maps to Property | Type   | Description                |
| ------------- | ---------------- | ------ | -------------------------- |
| `rows`        | `rows`           | JSON   | Row data as JSON array     |
| `columns`     | `columns`        | JSON   | Column config as JSON array|
| `grid-config` | `gridConfig`     | JSON   | Full config object as JSON |
| `fit-mode`    | `fitMode`        | string | `'stretch'` or `'fixed'`   |

```html
<tbw-grid
  rows='[{"id":1,"name":"Alice"},{"id":2,"name":"Bob"}]'
  columns='[{"field":"id","header":"ID"},{"field":"name","header":"Name"}]'
  fit-mode="stretch"
></tbw-grid>
```

### Light DOM Elements

Child elements inside `<tbw-grid>` for more readable, template-friendly configuration. Preferred for framework templates (Angular, Vue, etc.) and complex column setups with custom renderers/editors.

#### Column Elements

##### `<tbw-grid-column>`

Define column configuration declaratively.

| Attribute   | Type      | Description                                                      |
| ----------- | --------- | ---------------------------------------------------------------- |
| `field`     | `string`  | **Required.** Data field key                                     |
| `header`    | `string`  | Column header text                                               |
| `type`      | `string`  | Column type: `'string'`, `'number'`, `'boolean'`, `'date'`, `'select'` |
| `width`     | `string`  | Column width (e.g., `"120"`, `"100px"`, `"20%"`)                 |
| `min-width` | `number`  | Minimum column width in pixels                                   |
| `sortable`  | `boolean` | Enable sorting (presence = true)                                 |
| `resizable` | `boolean` | Enable resizing (presence = true)                                |
| `editable`  | `boolean` | Enable editing (presence = true, requires EditingPlugin)         |
| `options`   | `string`  | Select options: `"value1:Label1,value2:Label2"` or `"val1,val2"` |
| `renderer`  | `string`  | Named renderer (for framework adapter lookup)                    |
| `editor`    | `string`  | Named editor (for framework adapter lookup)                      |

```html
<tbw-grid>
  <tbw-grid-column field="id" header="ID" type="number" width="80"></tbw-grid-column>
  <tbw-grid-column field="name" header="Name" sortable resizable></tbw-grid-column>
  <tbw-grid-column field="role" type="select" options="admin:Admin,user:User"></tbw-grid-column>
</tbw-grid>
```

##### `<tbw-grid-column-view>`

Custom view template inside a column. Content is used as the cell renderer.

```html
<tbw-grid-column field="status">
  <tbw-grid-column-view>
    <span class="badge">{{ value }}</span>
  </tbw-grid-column-view>
</tbw-grid-column>
```

##### `<tbw-grid-column-editor>`

Custom editor template inside a column (requires EditingPlugin).

```html
<tbw-grid-column field="name" editable>
  <tbw-grid-column-editor>
    <input type="text" />
  </tbw-grid-column-editor>
</tbw-grid-column>
```

##### `<tbw-grid-column-header>`

Custom header template inside a column.

```html
<tbw-grid-column field="status">
  <tbw-grid-column-header>
    <strong>Status</strong> <span class="required">*</span>
  </tbw-grid-column-header>
</tbw-grid-column>
```

#### Shell Elements

##### `<tbw-grid-header>`

Configure the shell header bar.

| Attribute | Type     | Description              |
| --------- | -------- | ------------------------ |
| `title`   | `string` | Grid title (left side)   |

```html
<tbw-grid>
  <tbw-grid-header title="Employee Directory">
    <tbw-grid-header-content>
      <span>20 employees</span>
    </tbw-grid-header-content>
  </tbw-grid-header>
</tbw-grid>
```

##### `<tbw-grid-header-content>`

Custom content in the shell header center area. Must be nested inside `<tbw-grid-header>`.

```html
<tbw-grid-header title="My Grid">
  <tbw-grid-header-content>
    <input type="search" placeholder="Search..." />
  </tbw-grid-header-content>
</tbw-grid-header>
```

##### `<tbw-grid-tool-buttons>`

Container for toolbar buttons (right side of shell header).

```html
<tbw-grid>
  <tbw-grid-tool-buttons>
    <button class="tbw-toolbar-btn" title="Export">üì•</button>
    <button class="tbw-toolbar-btn" title="Print">üñ®Ô∏è</button>
  </tbw-grid-tool-buttons>
</tbw-grid>
```

#### Tool Panel Elements

##### `<tbw-grid-tool-panel>`

Define a custom tool panel for the sidebar.

| Attribute | Type     | Description                                    |
| --------- | -------- | ---------------------------------------------- |
| `id`      | `string` | **Required.** Unique panel identifier          |
| `title`   | `string` | **Required.** Panel title in accordion header  |
| `icon`    | `string` | Icon for accordion header (emoji or text)      |
| `tooltip` | `string` | Tooltip for accordion header                   |
| `order`   | `number` | Panel order priority (lower = first, default: 100) |

```html
<tbw-grid>
  <tbw-grid-tool-panel id="filters" title="Filters" icon="üîç" order="10">
    <div class="filter-panel">
      <label>Status: <select>...</select></label>
    </div>
  </tbw-grid-tool-panel>
</tbw-grid>
```

#### Plugin-Specific Elements

##### `<tbw-grid-detail>` (MasterDetailPlugin)

Define the detail panel template for master-detail rows. Requires the MasterDetailPlugin.

| Attribute                  | Type                          | Description                                    |
| -------------------------- | ----------------------------- | ---------------------------------------------- |
| `animation`                | `'slide'` \| `'fade'` \| `'false'` | Panel expand/collapse animation (default: `'slide'`) |
| `show-expand-column`       | `boolean`                     | Show expand/collapse column (default: `true`)  |
| `expand-on-row-click`      | `boolean`                     | Expand when row clicked (default: `false`)     |
| `collapse-on-click-outside`| `boolean`                     | Collapse when clicking outside (default: `false`) |
| `height`                   | `number` \| `'auto'`          | Panel height in pixels or auto (default: `'auto'`) |

```html
<tbw-grid>
  <tbw-grid-detail animation="slide" expand-on-row-click="true">
    <div class="detail-panel">
      <h3>{{ row.name }}</h3>
      <p>{{ row.description }}</p>
    </div>
  </tbw-grid-detail>
</tbw-grid>
```

See the [MasterDetailPlugin documentation](?path=/docs/grid-plugins-master-detail--docs) for more details.

##### `<tbw-grid-responsive-card>` (ResponsivePlugin)

Define a custom card template for responsive mode. Requires the ResponsivePlugin.

| Attribute         | Type                   | Description                                             |
| ----------------- | ---------------------- | ------------------------------------------------------- |
| `breakpoint`      | `number`               | Width threshold in pixels for responsive mode           |
| `card-row-height` | `number` \| `'auto'`   | Card height in pixels or auto (default: `'auto'`)       |
| `hidden-columns`  | `string`               | Comma-separated field names to hide in card mode        |
| `hide-header`     | `boolean`              | Hide header row in responsive mode (default: `true`)    |
| `debounce-ms`     | `number`               | Resize debounce delay in ms (default: `100`)            |

```html
<tbw-grid>
  <tbw-grid-responsive-card breakpoint="500" card-row-height="80" hidden-columns="createdAt, updatedAt">
    <div class="custom-card">
      <strong>{{ row.name }}</strong>
      <span>{{ row.email }}</span>
    </div>
  </tbw-grid-responsive-card>
</tbw-grid>
```

See the [ResponsivePlugin documentation](?path=/docs/grid-plugins-responsive--docs) for more details.

> **Note:** Framework adapters may provide wrapper components for these elements. For example, `@toolbox-web/grid-react` provides `<GridResponsiveCard>` and `<GridDetailPanel>` React components with render prop support. See the [React Adapter documentation](?path=/docs/grid-react-adapter--docs) for details.

## Helper Functions

```typescript
import { createGrid, queryGrid } from '@toolbox-web/grid';

// Create a new grid element with configuration
const grid = createGrid<Employee>({
  columns: [{ field: 'name' }, { field: 'email' }],
  fitMode: 'stretch',
});
document.body.appendChild(grid);
grid.rows = employees;

// Query an existing grid with type safety
const existingGrid = queryGrid<Employee>('#my-grid');
if (existingGrid) {
  existingGrid.rows = newData;
}
```

## Methods

### Data Methods

```typescript
// Update row data
grid.rows = newData;

// Wait for grid to be ready
await grid.ready();

// Force layout recalculation
await grid.forceLayout();

// Get current configuration (readonly)
const config = await grid.getConfig();
```

### Row Update API

The Row Update API provides ID-based access to individual rows for reading and updating data. This is especially useful when you need to update rows after external changes (e.g., API responses, WebSocket events) without replacing the entire dataset.

#### Row Identification

The grid automatically determines row IDs using these sources (in order of precedence):

1. `getRowId` function in gridConfig (custom ID resolution)
2. `id` property on the row object
3. `_id` property on the row object

> **Note:** Rows without any of these will not be accessible via the Row Update API. Calls to `getRow()` or `updateRow()` for such rows will return `undefined` or have no effect.

```typescript
// Configure custom row ID resolution
grid.gridConfig = {
  columns: [...],
  getRowId: (row) => row.employeeId, // Use a custom field as ID
};

// Get a row's ID
const id = grid.getRowId(row);
console.log(id); // "EMP-123"
```

#### Reading Rows

```typescript
// Get a single row by its ID
const employee = grid.getRow('EMP-123');
if (employee) {
  console.log(employee.name);
}

// Returns undefined if the row is not found
const missing = grid.getRow('unknown-id');
console.log(missing); // undefined
```

#### Updating Rows

```typescript
// Update a single row by ID
grid.updateRow('EMP-123', { status: 'active', salary: 75000 });

// Batch update multiple rows
grid.updateRows([
  { id: 'EMP-123', changes: { status: 'active' } },
  { id: 'EMP-456', changes: { department: 'Engineering' } },
]);

// Specify the update source (default: 'api')
// Valid sources: 'user' | 'cascade' | 'api'
grid.updateRow('EMP-123', { status: 'inactive' }, 'api');
grid.updateRows(updates, 'api');
```

#### Listening to Row Updates

The `cell-change` event fires whenever row data is updated via the Row Update API:

```typescript
import type { CellChangeDetail } from '@toolbox-web/grid';

grid.addEventListener('cell-change', (e: CustomEvent<CellChangeDetail>) => {
  const { rowId, changes, source, row } = e.detail;

  console.log(`Row ${rowId} updated via ${source}:`);
  console.log('Changes:', changes); // { status: 'active' }
  console.log('Full row:', row);    // Complete row object after update
});
```

See [`CellChangeDetail`](/docs/grid-api-core-interfaces-cellchangedetail--docs) for full type definition.

> **Note:** The `cell-change` event is distinct from `cell-commit`, which fires during inline editing. Use `cell-change` for programmatic updates via `updateRow()`/`updateRows()`.

### Column Methods

```typescript
// Get all columns with visibility info
const columns = grid.getAllColumns();
// Returns: Array<{ field, header, visible, lockVisible? }>

// Show/hide columns
grid.setColumnVisible('fieldName', false);
grid.toggleColumnVisibility('fieldName');
grid.showAllColumns();

// Check column visibility
const isVisible = grid.isColumnVisible('fieldName');

// Reorder columns
grid.setColumnOrder(['id', 'name', 'email']);
const order = grid.getColumnOrder();
```

### Editing Methods

```typescript
// Start bulk/row editing programmatically
await grid.beginBulkEdit(rowIndex);

// Commit active row edit
await grid.commitActiveRowEdit();

// Cancel active row edit
await grid.cancelActiveRowEdit();

// Get pending changes (array of changed rows)
const changes = grid.changedRows;

// Get indices of changed rows
const indices = grid.changedRowIndices;

// Reset changed rows tracking
await grid.resetChangedRows();
```

### Plugin Methods

```typescript
import { SelectionPlugin } from '@toolbox-web/grid/plugins/selection';

// Get a registered plugin instance
const selection = grid.getPlugin(SelectionPlugin);

// Check if plugin is registered
if (selection) {
  selection.selectAll();
}
```

### Column State Persistence

```typescript
// Get current column state (for saving)
const state = grid.getColumnState();
localStorage.setItem('gridState', JSON.stringify(state));

// Restore column state
const saved = localStorage.getItem('gridState');
if (saved) {
  grid.columnState = JSON.parse(saved);
}

// Reset to initial configuration
grid.resetColumnState();
```

### Shell Methods (Header/Toolbar)

```typescript
// Register a tool panel
grid.registerToolPanel({
  id: 'myPanel',
  title: 'My Panel',
  icon: '‚öôÔ∏è',
  render: (container) => {
    container.innerHTML = '<div>Panel content</div>';
  },
});

// Open/close/toggle the tool panel sidebar
grid.openToolPanel();
grid.closeToolPanel();
grid.toggleToolPanel();

// Toggle specific accordion sections
grid.toggleToolPanelSection('myPanel');

// Check panel state
const isOpen = grid.isToolPanelOpen;
const sections = grid.expandedToolPanelSections;

// Get registered panels
const panels = grid.getToolPanels();
```

## Events

### Edit Events

| Event                | Detail Type         | Cancelable | Description                         |
| -------------------- | ------------------- | ---------- | ----------------------------------- |
| `cell-commit`        | [`CellCommitDetail`](/docs/grid-api-core-interfaces-cellcommitdetail--docs)  | ‚úÖ Yes     | Cell value was edited (inline)      |
| `cell-change`        | [`CellChangeDetail`](/docs/grid-api-core-interfaces-cellchangedetail--docs)  | No         | Row updated via Row Update API      |
| `row-commit`         | [`RowCommitDetail`](/docs/grid-api-core-interfaces-rowcommitdetail--docs)   | No         | Bulk row edit completed             |
| `changed-rows-reset` | -                   | No         | Changed rows were reset             |

```typescript
grid.addEventListener('cell-commit', (e: CustomEvent<CellCommitDetail>) => {
  const { row, field, value, oldValue, rowIndex } = e.detail;
  console.log(`Cell ${field} changed from ${oldValue} to ${value}`);

  // Optionally prevent the change
  if (!isValid(value)) {
    e.preventDefault();
  }
});
```

See [`CellCommitDetail`](/docs/grid-api-core-interfaces-cellcommitdetail--docs) for full type definition.

```typescript
```

### Sort Events

| Event         | Detail Type        | Description        |
| ------------- | ------------------ | ------------------ |
| `sort-change` | [`SortChangeDetail`](/docs/grid-api-core-interfaces-sortchangedetail--docs) | Sort state changed |

```typescript
grid.addEventListener('sort-change', (e: CustomEvent<SortChangeDetail>) => {
  const { field, direction, sortState } = e.detail;
  console.log(`Sorted by ${field} ${direction}`);
});
```

### Interaction Events

| Event                 | Detail Type            | Cancelable | Description                                        |
| --------------------- | ---------------------- | ---------- | -------------------------------------------------- |
| `cell-click`          | [`CellClickDetail`](/docs/grid-api-core-interfaces-cellclickdetail--docs)      | No         | Cell was clicked (after plugin handling)           |
| `row-click`           | [`RowClickDetail`](/docs/grid-api-core-interfaces-rowclickdetail--docs)       | No         | Row was clicked (after plugin handling)            |
| `cell-activate`       | [`CellActivateDetail`](/docs/grid-api-core-interfaces-cellactivatedetail--docs)   | ‚úÖ Yes     | Cell activated via Enter or click. Check `trigger` |
| `activate-cell`       | [`ActivateCellDetail`](/docs/grid-api-core-interfaces-activatecelldetail--docs)   | ‚úÖ Yes     | ‚ö†Ô∏è **Deprecated.** Use `cell-activate` instead     |
| `column-resize`       | [`ColumnResizeDetail`](/docs/grid-api-core-interfaces-columnresizedetail--docs)   | No         | Column was resized                                 |
| `column-state-change` | [`GridColumnState`](/docs/grid-api-core-interfaces-gridcolumnstate--docs)      | No         | Column visibility or order changed                 |

### External Rendering Events

| Event                   | Detail Type                 | Description                      |
| ----------------------- | --------------------------- | -------------------------------- |
| `mount-external-view`   | [`ExternalMountViewDetail`](/docs/grid-api-framework-adapters-interfaces-externalmountviewdetail--docs)   | Request external view renderer   |
| `mount-external-editor` | [`ExternalMountEditorDetail`](/docs/grid-api-framework-adapters-interfaces-externalmounteditordetail--docs) | Request external editor renderer |

### Cancelable Events

Some events are **cancelable**, meaning you can call `event.preventDefault()` to stop the default behavior. This enables validation, conditional blocking, and state rollback scenarios.

#### Core Grid Events

| Event           | Cancelable | Effect when cancelled                          |
| --------------- | ---------- | ---------------------------------------------- |
| `cell-commit`   | ‚úÖ Yes     | Value change is rejected; cell keeps old value |
| `cell-activate` | ‚úÖ Yes     | Cell activation is blocked                     |

#### `cell-commit` ‚Äî Validation Before Save

Use this to validate cell values before they're applied. The event fires **before** the value is written, so calling `preventDefault()` keeps the original value intact.

```typescript
grid.addEventListener('cell-commit', (e: CustomEvent<CellCommitDetail>) => {
  const { field, value, oldValue, row } = e.detail;

  // Example: Prevent negative values in 'salary' field
  if (field === 'salary' && typeof value === 'number' && value < 0) {
    e.preventDefault();
    alert('Salary cannot be negative');
    return;
  }

  // Example: Require manager approval for large changes
  if (field === 'budget' && value > 100000) {
    e.preventDefault();
    showApprovalDialog(row, value);
  }
});
```

#### `cell-activate` ‚Äî Unified Cell Activation

The `cell-activate` event fires when a cell is activated via **Enter key** or **click**. Use the `trigger` property to distinguish between keyboard and pointer activation.

**This event fires BEFORE plugins process the activation**, allowing you to:
- Block editing from starting by calling `e.preventDefault()`
- Prevent selection changes on certain cells
- Implement custom activation logic

See [`CellActivateDetail`](/docs/grid-api-core-interfaces-cellactivatedetail--docs) for full type definition.

```typescript
import type { CellActivateDetail } from '@toolbox-web/grid';

grid.addEventListener('cell-activate', (e: CustomEvent<CellActivateDetail>) => {
  const { rowIndex, colIndex, field, value, row, trigger } = e.detail;

  // Handle both keyboard and pointer activation uniformly
  console.log(`Cell ${field} activated via ${trigger}`);

  // Or differentiate if needed
  if (trigger === 'keyboard') {
    // Enter key pressed
  } else {
    // Click/tap
  }

  // Block activation on locked rows (prevents editing from starting)
  if ((row as any)?.locked) {
    e.preventDefault();
    return;
  }
});
```

> **Note:** The legacy `activate-cell` event is deprecated but still emitted for backwards compatibility. Migrate to `cell-activate` for unified keyboard/pointer handling.

> **Note:** Non-cancelable events like `sort-change` and `column-resize` are informational‚Äîuse column-level flags (`sortable: false`, `resizable: false`) to disable those features entirely.
>
> Plugins may emit their own cancelable events. See individual plugin documentation for details.

## CSS Custom Properties

See the [Theming](../?path=/docs/grid-theming--docs) page for the complete list of CSS custom properties.

### Quick Reference

```css
tbw-grid {
  /* Colors */
  --tbw-color-bg: #ffffff;
  --tbw-color-fg: #333333;
  --tbw-color-border: #e0e0e0;
  --tbw-color-primary: #1976d2;

  /* Header */
  --tbw-header-bg: #f5f5f5;
  --tbw-header-fg: #333333;

  /* Rows */
  --tbw-row-hover-bg: #f0f7ff;
  --tbw-row-selected-bg: #e3f2fd;

  /* Sizing */
  --tbw-row-height: 36px;
  --tbw-header-height: 40px;
}
```

## CSS Parts

```css
tbw-grid::part(container) {
  /* Main container */
}
tbw-grid::part(header) {
  /* Header row */
}
tbw-grid::part(body) {
  /* Body/rows container */
}
```

## TypeScript Types

### Column Configuration ‚Äî [`ColumnConfig`](/docs/grid-api-core-interfaces-columnconfig--docs)

```typescript
interface ColumnConfig {
  field: string; // Data field key
  header?: string; // Display header text
  type?: ColumnType; // 'string' | 'number' | 'boolean' | 'date' | 'select'
  width?: number; // Width in pixels
  minWidth?: number; // Minimum width
  maxWidth?: number; // Maximum width
  sortable?: boolean; // Enable sorting
  resizable?: boolean; // Enable resizing
  editable?: boolean; // Enable editing
  hidden?: boolean; // Initially hidden
  pinned?: 'left' | 'right'; // Pin to edge
  align?: 'left' | 'center' | 'right';

  // Custom rendering
  formatter?: (value: any, row: T) => string;
  renderer?: (value: any, row: T, cell: HTMLElement) => void;

  // Custom header rendering (see Core Grid docs for examples)
  headerLabelRenderer?: (ctx: HeaderLabelContext) => string | HTMLElement;
  headerRenderer?: (ctx: HeaderCellContext) => string | HTMLElement;

  // Dynamic cell styling
  cellClass?: (value: any, row: T, column: ColumnConfig) => string[];

  // Select type options
  options?: Array<{ label: string; value: any }>;
}
```

See also: [`ColumnType`](/docs/grid-api-core-types-columntype--docs), [`HeaderLabelContext`](/docs/grid-api-core-interfaces-headerlabelcontext--docs), [`HeaderCellContext`](/docs/grid-api-core-interfaces-headercellcontext--docs)

#### cellClass Callback

Apply dynamic CSS classes to individual cells based on cell value, row data, or column configuration.

```typescript
const columns: ColumnConfig[] = [
  {
    field: 'score',
    header: 'Score',
    cellClass: (value, row, column) => {
      if (value < 30) return ['score-low'];
      if (value > 70) return ['score-high'];
      return ['score-medium'];
    },
  },
  {
    field: 'status',
    header: 'Status',
    cellClass: (value) => [`status-${value}`], // e.g., 'status-active', 'status-pending'
  },
];
```

### Grid Configuration ‚Äî [`GridConfig`](/docs/grid-api-core-interfaces-gridconfig--docs)

```typescript
interface GridConfig<T> {
  columns?: ColumnConfig[];
  fitMode?: 'stretch' | 'fixed';
  plugins?: BaseGridPlugin[];
  shell?: ShellConfig;          // Shell header/toolbar/tool panel config
  animation?: AnimationConfig;  // Animation behavior config
  icons?: Partial<GridIcons>;   // Custom icons (SVG strings or emoji)
  getRowId?: (row: T) => string; // Custom row ID resolver
  typeDefaults?: Record<string, TypeDefault<T>>; // Type-level renderer/editor defaults

  // Dynamic row styling
  rowClass?: (row: T) => string[];
}
```

See also: [`ColumnConfig`](/docs/grid-api-core-interfaces-columnconfig--docs), [`BaseGridPlugin`](/docs/grid-api-plugin-development-classes-basegridplugin--docs), [`ShellConfig`](/docs/grid-api-core-interfaces-shellconfig--docs), [`AnimationConfig`](/docs/grid-api-core-interfaces-animationconfig--docs), [`GridIcons`](/docs/grid-api-core-interfaces-gridicons--docs), [`TypeDefault`](/docs/grid-api-core-interfaces-typedefault--docs)

**See Also:**
- [Header Renderers](?path=/docs/grid-core--docs#custom-header-renderers) - Custom column header rendering
- [Shell Components](?path=/docs/grid-core--docs#shell-components) - Toolbar, tool panels, and header bar

#### rowClass Callback

Apply dynamic CSS classes to entire rows based on row data.

```typescript
const config: GridConfig<Employee> = {
  rowClass: (row) => {
    const classes: string[] = [];
    if (!row.active) classes.push('row-inactive');
    if (row.priority === 'high') classes.push('row-priority');
    if (row.role === 'admin') classes.push('row-admin');
    return classes;
  },
};
```

**Notes:**
- Both callbacks return `string[]` (array of class names to apply)
- Empty array `[]` means no dynamic classes
- Classes are automatically cleaned up when row/cell data changes
- Errors in callbacks are caught and logged to console (rendering continues)
- See the [RowClass](?path=/story/grid-core--row-class) and [CellClass](?path=/story/grid-core--cell-class) stories for live demos

#### typeDefaults ‚Äî [`TypeDefault`](/docs/grid-api-core-interfaces-typedefault--docs)

Define formatters, renderers, and editors at the type level, applying to all columns with matching `type`:

```typescript
interface TypeDefault<TRow = unknown> {
  format?: (value: unknown, row: TRow) => string; // Custom value formatter
  renderer?: ColumnViewRenderer<TRow>;  // Custom cell renderer
  editor?: ColumnEditorSpec<TRow>;      // Custom cell editor (requires EditingPlugin)
  editorParams?: Record<string, unknown>; // Default editor parameters (requires EditingPlugin)
  filterPanelRenderer?: FilterPanelRenderer; // Custom filter panel (requires FilteringPlugin)
}

const config: GridConfig<Employee> = {
  typeDefaults: {
    // Formatter - transforms value to display string
    currency: {
      format: (value) => new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
      }).format(value as number),
    },
    // Renderer - creates custom DOM
    country: {
      renderer: (ctx) => {
        const span = document.createElement('span');
        span.textContent = `üåç ${ctx.value}`;
        return span;
      },
    },
  },
  columns: [
    { field: 'salary', type: 'currency' },  // Uses currency formatter
    { field: 'country', type: 'country' },  // Uses country renderer
  ],
};
```

**Resolution Priority**: Column-level ‚Üí Grid typeDefaults ‚Üí App-level (framework adapter) ‚Üí Built-in

> **Note:** The `format` and `renderer` properties are **core features** that work without any plugins. The `editor` and `editorParams` properties require the EditingPlugin, and `filterPanelRenderer` requires the FilteringPlugin.

See the [Core Grid docs](?path=/docs/grid-core--docs#type-level-defaults) for formatter/renderer examples, or the [Editing Plugin docs](?path=/docs/grid-plugins-editing--docs#type-level-defaults) for editor examples.

### Animation Configuration ‚Äî [`AnimationConfig`](/docs/grid-api-core-interfaces-animationconfig--docs)

The grid supports a global animation configuration that controls whether animations run.
Individual plugins define their own animation styles.

```typescript
// Animation behavior mode
type AnimationMode = boolean | 'on' | 'off' | 'reduced-motion';

// Animation style (used by plugins)
type AnimationStyle = 'slide' | 'fade' | 'flip' | false;

// Grid-level animation config
interface AnimationConfig {
  // Global animation mode (default: 'reduced-motion')
  mode?: AnimationMode;

  // Animation duration in ms (default: 200)
  duration?: number;

  // Easing function (default: 'ease-out')
  easing?: string;

  // Style for sorting row changes (core feature, default: false)
  sort?: AnimationStyle;
}
```

See also: [`AnimationMode`](/docs/grid-api-core-types-animationmode--docs), [`AnimationStyle`](/docs/grid-api-core-types-animationstyle--docs)

#### Animation Modes

| Mode               | Behavior                                                |
| ------------------ | ------------------------------------------------------- |
| `true` / `'on'`    | Animations always enabled                               |
| `false` / `'off'`  | Animations always disabled                              |
| `'reduced-motion'` | Respects `prefers-reduced-motion` media query (default) |

#### Plugin Animation Styles

Each plugin defines its own animation style in its config:

```typescript
// ReorderPlugin - column reordering animation
new ReorderPlugin({ animation: 'flip' }); // 'flip' | 'fade' | false

// MasterDetailPlugin - expand/collapse animation
new MasterDetailPlugin({ animation: 'slide' }); // 'slide' | 'fade' | false

// TreePlugin - tree node expand/collapse
new TreePlugin({ animation: 'slide' }); // 'slide' | 'fade' | false

// GroupingRowsPlugin - group expand/collapse
new GroupingRowsPlugin({ animation: 'slide' }); // 'slide' | 'fade' | false
```

#### CSS Variables

Animation duration and easing are exposed via CSS custom properties:

```css
tbw-grid {
  --tbw-animation-duration: 200ms;
  --tbw-animation-easing: ease-out;
  --tbw-animation-enabled: 1; /* 0 = disabled, 1 = enabled */
}
```

#### Example

```typescript
grid.gridConfig = {
  // Grid-level: enable animations, set timing
  animation: {
    mode: 'on',
    duration: 300,
    easing: 'ease-in-out',
  },
  // Plugin-level: each plugin configures its own style
  plugins: [
    new ReorderPlugin({ animation: 'flip' }),
    new MasterDetailPlugin({ animation: 'slide' }),
    new TreePlugin({ animation: 'fade' }),
  ],
};
```

### Shell Configuration ‚Äî [`ShellConfig`](/docs/grid-api-core-interfaces-shellconfig--docs)

```typescript
interface ShellConfig {
  header?: ShellHeaderConfig;   // Header bar with title and toolbar
  toolPanel?: ToolPanelConfig;  // Tool panel sidebar settings
}

interface ShellHeaderConfig {
  title?: string;  // Grid title displayed on the left
}

interface ToolPanelConfig {
  position?: 'left' | 'right';  // Panel position (default: 'right')
  width?: number;               // Panel width in pixels (default: 280)
  defaultOpen?: string;         // Panel ID to open by default
}
```

See also: [`ShellHeaderConfig`](/docs/grid-api-core-interfaces-shellheaderconfig--docs), [`ToolPanelConfig`](/docs/grid-api-core-interfaces-toolpanelconfig--docs)

### Icon Customization ‚Äî [`GridIcons`](/docs/grid-api-core-interfaces-gridicons--docs)

```typescript
// Override any grid icon with SVG string or emoji
grid.gridConfig = {
  icons: {
    sortAsc: '‚Üë',
    sortDesc: '‚Üì',
    expand: '+',
    collapse: '‚àí',
    // ... see GridIcons type for all available icons
  },
};
```

### Accessibility

The grid follows the [W3C WAI-ARIA Grid Pattern](https://www.w3.org/WAI/ARIA/apg/patterns/grid/) and includes built-in accessibility features.

#### ARIA Labels

Provide accessible names for screen reader users:

```typescript
grid.gridConfig = {
  gridAriaLabel: 'Employee directory',
  gridAriaDescribedBy: 'grid-description', // ID of element with description
};
```

If `gridAriaLabel` is not set but `shell.header.title` is configured, the title is used automatically as the accessible name.

#### Keyboard Navigation

Full keyboard support for navigation, editing, and selection. See [Keyboard Shortcuts](#keyboard-shortcuts) below.

#### Built-in ARIA Attributes

The grid automatically provides:

- `role="grid"` on the data container
- `role="row"` and `role="gridcell"` on rows and cells
- `role="columnheader"` on header cells
- `aria-rowcount` and `aria-colcount` for total counts
- `aria-rowindex` and `aria-colindex` on each cell
- `aria-sort` on sortable headers
- `aria-selected` on focused/selected cells
- `aria-readonly` on non-editable cells (when EditingPlugin is active)
- `aria-checked` on boolean cells

### Event Details

```typescript
interface CellCommitDetail<T = any> {
  row: T;
  field: string;
  value: any;
  oldValue: any;
  rowIndex: number;
}

interface CellChangeDetail<T = any> {
  row: T;              // Row object after mutation
  rowId: string;       // Stable row identifier
  rowIndex: number;    // Current index in rows array
  field: string;       // Field that changed
  oldValue: any;       // Value before change
  newValue: any;       // Value after change
  changes: Partial<T>; // All changes passed to updateRow/updateRows
  source: string;      // Origin: 'api', 'websocket', etc.
}

interface SortChangeDetail {
  field: string;
  direction: 'asc' | 'desc' | null;
  sortState: Map<string, SortState>;
}

interface ColumnResizeDetail {
  field: string;
  width: number;
  previousWidth: number;
}
```

See also: [`CellCommitDetail`](/docs/grid-api-core-interfaces-cellcommitdetail--docs), [`CellChangeDetail`](/docs/grid-api-core-interfaces-cellchangedetail--docs), [`SortChangeDetail`](/docs/grid-api-core-interfaces-sortchangedetail--docs), [`ColumnResizeDetail`](/docs/grid-api-core-interfaces-columnresizedetail--docs), [`SortState`](/docs/grid-api-core-interfaces-sortstate--docs)

## Keyboard Shortcuts

| Shortcut                 | Action                              |
| ------------------------ | ----------------------------------- |
| `‚Üë` `‚Üì` `‚Üê` `‚Üí`          | Navigate between cells              |
| `Enter`                  | Start editing / confirm edit        |
| `Escape`                 | Cancel editing / clear selection    |
| `Tab` / `Shift+Tab`      | Move to next/previous editable cell |
| `Home` / `End`           | Jump to first/last column           |
| `Ctrl+Home` / `Ctrl+End` | Jump to first/last row              |
| `Page Up` / `Page Down`  | Scroll by page                      |
| `F2`                     | Start editing current cell          |

## Browser Support

The grid uses standard Web Components APIs and is compatible with:

- Chrome/Edge 79+
- Firefox 63+
- Safari 13.1+

No polyfills required for modern browsers.
