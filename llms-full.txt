# @toolbox-web/grid - Complete AI Implementation Guide

> A high-performance, framework-agnostic data grid built with pure TypeScript and native Web Components. Zero runtime dependencies. Works in vanilla JS, React, Angular, Vue, Svelte, and any JavaScript environment.

Important notes:

- This is a **Web Component** (`<tbw-grid>`) that works natively in all frameworks without wrappers
- Optional adapter packages (`@toolbox-web/grid-angular`, `@toolbox-web/grid-react`) enable JSX/template renderers
- All features are **opt-in via plugins** - import only what you need for tree-shaking
- Configuration uses a **single source of truth** pattern via `gridConfig` property
- Editing requires `EditingPlugin` - using `editable: true` without it throws a helpful error
- Uses **light DOM** (not Shadow DOM) for CSS cascade and accessibility
- All sizing uses `em` units - change font-size to scale the entire grid

---

## Quick Start by Framework

### Vanilla JavaScript / TypeScript

```typescript
import '@toolbox-web/grid';
import { createGrid } from '@toolbox-web/grid';
import { SelectionPlugin } from '@toolbox-web/grid/plugins/selection';
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';

interface Employee {
  id: number;
  name: string;
  email: string;
  department: string;
}

const grid = createGrid<Employee>({
  columns: [
    { field: 'id', header: 'ID', type: 'number', width: 60 },
    { field: 'name', header: 'Name', editable: true },
    { field: 'email', header: 'Email' },
    { field: 'department', header: 'Department', sortable: true },
  ],
  plugins: [
    new SelectionPlugin({ mode: 'row' }),
    new EditingPlugin(),
  ],
});

grid.rows = employees;
grid.style.height = '400px';
document.body.appendChild(grid);
```

### React

```tsx
import '@toolbox-web/grid';
import { DataGrid, type ReactGridConfig } from '@toolbox-web/grid-react';
import { SelectionPlugin } from '@toolbox-web/grid/plugins/selection';
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';

interface Employee {
  id: number;
  name: string;
  status: 'active' | 'inactive';
}

const config: ReactGridConfig<Employee> = {
  columns: [
    { field: 'id', header: 'ID', type: 'number' },
    { field: 'name', header: 'Name', editable: true },
    {
      field: 'status',
      header: 'Status',
      // React component as renderer
      renderer: (ctx) => (
        <span className={`badge badge-${ctx.value}`}>{ctx.value}</span>
      ),
      // React component as editor
      editor: (ctx) => (
        <select
          defaultValue={ctx.value}
          onChange={(e) => ctx.commit(e.target.value)}
          autoFocus
        >
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>
      ),
      editable: true,
    },
  ],
  plugins: [
    new SelectionPlugin({ mode: 'row' }),
    new EditingPlugin(),
  ],
};

function EmployeeGrid({ employees }: { employees: Employee[] }) {
  const [data, setData] = useState(employees);

  return (
    <DataGrid
      rows={data}
      gridConfig={config}
      onRowsChange={setData}
      style={{ height: '400px' }}
    />
  );
}
```

### Angular

```typescript
import { Component, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { Grid, TbwRenderer, TbwEditor } from '@toolbox-web/grid-angular';
import { SelectionPlugin } from '@toolbox-web/grid/plugins/selection';
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';
import type { GridConfig } from '@toolbox-web/grid';

// Import grid registration
import '@toolbox-web/grid';

@Component({
  selector: 'app-employee-grid',
  standalone: true,
  imports: [Grid, TbwRenderer, TbwEditor],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <tbw-grid [rows]="employees" [gridConfig]="config" style="height: 400px; display: block;">
      <tbw-grid-column field="status">
        <!-- Structural directive for renderer -->
        <app-status-badge *tbwRenderer="let value; row as row" [status]="value" />
        <!-- Structural directive for editor - auto-wires commit/cancel -->
        <app-status-select *tbwEditor="let value" [value]="value" />
      </tbw-grid-column>
    </tbw-grid>
  `,
})
export class EmployeeGridComponent {
  employees = [
    { id: 1, name: 'Alice', status: 'active' },
    { id: 2, name: 'Bob', status: 'inactive' },
  ];

  config: GridConfig = {
    columns: [
      { field: 'id', header: 'ID', type: 'number' },
      { field: 'name', header: 'Name', editable: true },
      { field: 'status', header: 'Status', editable: true },
    ],
    plugins: [
      new SelectionPlugin({ mode: 'row' }),
      new EditingPlugin(),
    ],
  };
}
```

### Angular Reactive Forms Integration

Bind a `FormArray` directly to the grid for validation support and cell-level FormControl access:

```typescript
import { Component, inject, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';
import { Grid, GridFormArray, TbwEditor, TbwRenderer } from '@toolbox-web/grid-angular';
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';
import '@toolbox-web/grid';

@Component({
  imports: [Grid, GridFormArray, TbwEditor, TbwRenderer, ReactiveFormsModule],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <form [formGroup]="form">
      <tbw-grid [formArray]="form.controls.employees" [gridConfig]="config" style="height: 400px; display: block;">
        <tbw-grid-column field="age" editable>
          <span *tbwRenderer="let value">{{ value }}</span>
          <!-- 'control' provides the cell's FormControl -->
          <input *tbwEditor="let value; control as ctrl" [formControl]="ctrl" type="number" />
        </tbw-grid-column>
      </tbw-grid>
    </form>

    <p>Form Valid: {{ form.valid }} | Dirty: {{ form.controls.employees.dirty }}</p>
  `,
})
export class ReactiveFormsGridComponent {
  private fb = inject(FormBuilder);

  form = this.fb.group({
    employees: this.fb.array([
      this.fb.group({ name: ['Alice', Validators.required], age: [30, Validators.min(18)] }),
      this.fb.group({ name: ['Bob', Validators.required], age: [25, Validators.min(18)] }),
    ])
  });

  config = {
    columns: [
      { field: 'name', header: 'Name', editable: true },
      { field: 'age', header: 'Age', editable: true },
    ],
    plugins: [new EditingPlugin()],
  };
}
```

**Key Features:**
- `[formArray]` directive binds FormArray to grid rows
- Cell edits update the corresponding FormControl
- Access cell-level FormControl via `control` in `*tbwEditor` context
- Row-level validation: `getFormArrayContext(gridElement).isRowValid(index)`
- Automatic CSS classes: `.ng-valid`, `.ng-invalid`, `.ng-dirty`, `.ng-touched`

---

## Core Concepts

### Configuration Precedence

The grid merges configuration from multiple sources (lowest to highest priority):

1. `gridConfig` property (base configuration)
2. Light DOM elements (`<tbw-grid-column>`, `<tbw-grid-header>`)
3. `columns` property (direct array)
4. Individual props (`fitMode`)

### Column Configuration

```typescript
interface ColumnConfig {
  field: string;              // Required: property key in row data
  header?: string;            // Display label (defaults to field)
  type?: 'string' | 'number' | 'date' | 'boolean' | 'select';
  width?: number | string;    // Pixels, '1fr', or percentage
  sortable?: boolean;         // Enable sorting (default: true)
  resizable?: boolean;        // Enable resize (default: true)
  editable?: boolean;         // Enable editing (requires EditingPlugin)
  hidden?: boolean;           // Initially hidden
  lockVisible?: boolean;      // Prevent hiding via UI
  format?: (value: any, row: T) => string;  // Display formatter
  renderer?: (ctx: CellContext) => HTMLElement | string;  // Custom render
  editor?: (ctx: EditorContext) => HTMLElement;  // Custom editor
}
```

### Plugin System

Plugins are class instances passed via `gridConfig.plugins`:

```typescript
import { SelectionPlugin } from '@toolbox-web/grid/plugins/selection';
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';
import { FilteringPlugin } from '@toolbox-web/grid/plugins/filtering';
import { MultiSortPlugin } from '@toolbox-web/grid/plugins/multi-sort';
import { RowGroupingPlugin } from '@toolbox-web/grid/plugins/grouping-rows';
import { ColumnGroupingPlugin } from '@toolbox-web/grid/plugins/grouping-columns';
import { PinnedColumnsPlugin } from '@toolbox-web/grid/plugins/pinned-columns';
import { PinnedRowsPlugin } from '@toolbox-web/grid/plugins/pinned-rows';
import { ResponsivePlugin } from '@toolbox-web/grid/plugins/responsive';
import { ReorderPlugin } from '@toolbox-web/grid/plugins/reorder';
import { VisibilityPlugin } from '@toolbox-web/grid/plugins/visibility';
import { ColumnVirtualizationPlugin } from '@toolbox-web/grid/plugins/column-virtualization';
import { ExportPlugin } from '@toolbox-web/grid/plugins/export';
import { ContextMenuPlugin } from '@toolbox-web/grid/plugins/context-menu';

grid.gridConfig = {
  columns: [...],
  plugins: [
    new SelectionPlugin({ mode: 'row', checkbox: true }),
    new EditingPlugin({ mode: 'cell', trigger: 'dblclick' }),
    new FilteringPlugin({ debounceMs: 300 }),
    new MultiSortPlugin({ maxSortColumns: 3 }),
    new RowGroupingPlugin(),
    new ColumnGroupingPlugin(),
    new PinnedColumnsPlugin(),
    new PinnedRowsPlugin(),
    new ResponsivePlugin({ breakpoint: 600 }),
    new ReorderPlugin(),
    new VisibilityPlugin(),
    new ExportPlugin({ formats: ['csv', 'json'] }),
    new ContextMenuPlugin({ items: [...] }),
  ],
};
```

### Events

Listen to grid events via `addEventListener`:

```typescript
import { DGEvents } from '@toolbox-web/grid';

grid.addEventListener(DGEvents.CELL_COMMIT, (e) => {
  console.log('Cell edited:', e.detail);
  // { field, value, oldValue, row, rowIndex }
});

grid.addEventListener(DGEvents.SORT_CHANGE, (e) => {
  console.log('Sort changed:', e.detail);
});

grid.addEventListener(DGEvents.ROW_COMMIT, (e) => {
  console.log('Row committed:', e.detail);
});
```

### Row Animation API

Trigger visual feedback when rows change:

```typescript
// Animate a single row by index
grid.animateRow(5, 'change');  // Flash highlight
grid.animateRow(0, 'insert');  // Slide-in animation
grid.animateRow(3, 'remove');  // Fade-out animation

// Animate multiple rows
grid.animateRows([0, 1, 2], 'change');

// Animate by row ID (returns false if not found)
if (grid.animateRowById('emp-123', 'change')) {
  console.log('Row animated');
}
```

**Animation Types:**
- `'change'` - Flash highlight for updated rows
- `'insert'` - Slide-in for new rows
- `'remove'` - Fade-out for deleted rows

**Animation Configuration:**

```typescript
grid.gridConfig = {
  animation: {
    mode: 'on',           // 'on' | 'off' | 'reduced-motion'
    style: 'smooth',      // 'smooth' | 'instant'
    duration: 200,        // ms
  },
};
```

### Factory Functions

Helper functions for typed grid creation:

```typescript
import { createGrid, queryGrid } from '@toolbox-web/grid';

// Create a typed grid (avoids manual casting)
const grid = createGrid<Employee>({
  columns: [{ field: 'name' }],
  plugins: [new SelectionPlugin()],
});
grid.rows = employees; // ✓ Fully typed

// Query an existing grid with typing
const existing = queryGrid<Employee>('#my-grid');
if (existing) {
  existing.rows = employees;
}
```

---

## Migration Guides

### From AG Grid

AG Grid uses a different configuration model. Here's how to translate:

| AG Grid | @toolbox-web/grid |
|---------|-------------------|
| `<ag-grid-angular>` | `<tbw-grid>` with `Grid` directive |
| `<AgGridReact>` | `<DataGrid>` from `@toolbox-web/grid-react` |
| `columnDefs` | `columns` or `gridConfig.columns` |
| `rowData` | `rows` |
| `defaultColDef` | Use `typeDefaults` for type-level defaults |
| `getRowId` | `gridConfig.getRowId` |
| `onCellValueChanged` | `addEventListener('cell-commit', ...)` |
| `onSortChanged` | `addEventListener('sort-change', ...)` |
| `modules` | `plugins` (class instances, not module imports) |

**AG Grid Column Definition → @toolbox-web/grid:**

```typescript
// AG Grid
{
  field: 'name',
  headerName: 'Name',
  editable: true,
  sortable: true,
  filter: true,
  pinned: 'left',
  cellRenderer: (params) => `<b>${params.value}</b>`,
}

// @toolbox-web/grid
{
  field: 'name',
  header: 'Name',           // headerName → header
  editable: true,           // requires EditingPlugin
  sortable: true,           // same
  filterable: true,         // requires FilteringPlugin
  sticky: 'left',           // pinned → sticky, requires PinnedColumnsPlugin
  renderer: (ctx) => {      // cellRenderer → renderer
    const b = document.createElement('b');
    b.textContent = ctx.value;
    return b;
  },
}
```

**Plugin Migration:**

```typescript
// AG Grid modules
import { ClientSideRowModelModule } from '@ag-grid-community/client-side-row-model';
import { RowGroupingModule } from '@ag-grid-enterprise/row-grouping';

// @toolbox-web/grid plugins
import { RowGroupingPlugin } from '@toolbox-web/grid/plugins/grouping-rows';
import { SelectionPlugin } from '@toolbox-web/grid/plugins/selection';

gridConfig: {
  plugins: [
    new RowGroupingPlugin(),
    new SelectionPlugin({ mode: 'row' }),
  ],
}
```

### From TanStack Table (React Table)

TanStack Table is headless; @toolbox-web/grid provides the complete UI:

| TanStack Table | @toolbox-web/grid |
|----------------|-------------------|
| `useReactTable()` | No hook needed - use `<DataGrid>` |
| `columnHelper.accessor()` | Column config with `field` |
| `cell: (info) => ...` | `renderer: (ctx) => ...` |
| `getSortedRowModel()` | `sortable: true` on columns |
| `getFilteredRowModel()` | `FilteringPlugin` |
| `getGroupedRowModel()` | `RowGroupingPlugin` |
| `useVirtualizer()` | Built-in row virtualization |

**TanStack Table → @toolbox-web/grid:**

```tsx
// TanStack Table
const columns = [
  columnHelper.accessor('name', {
    header: 'Name',
    cell: (info) => <b>{info.getValue()}</b>,
  }),
  columnHelper.accessor('status', {
    header: 'Status',
    cell: (info) => <Badge status={info.getValue()} />,
  }),
];

const table = useReactTable({
  data,
  columns,
  getCoreRowModel: getCoreRowModel(),
  getSortedRowModel: getSortedRowModel(),
});

// @toolbox-web/grid
const config: ReactGridConfig<Employee> = {
  columns: [
    {
      field: 'name',
      header: 'Name',
      renderer: (ctx) => <b>{ctx.value}</b>,
    },
    {
      field: 'status',
      header: 'Status',
      renderer: (ctx) => <Badge status={ctx.value} />,
    },
  ],
};

<DataGrid rows={data} gridConfig={config} />
```

### From ngx-datatable

ngx-datatable uses similar concepts but different syntax:

| ngx-datatable | @toolbox-web/grid |
|---------------|-------------------|
| `<ngx-datatable>` | `<tbw-grid>` with `Grid` directive |
| `[rows]` | `[rows]` (same!) |
| `<ngx-datatable-column>` | `<tbw-grid-column>` |
| `[name]` | `header` |
| `[prop]` | `field` |
| `<ng-template let-value>` | `*tbwRenderer="let value"` |
| `[sortable]` | `sortable` |
| `(sort)` | `addEventListener('sort-change', ...)` |

**ngx-datatable → @toolbox-web/grid:**

```html
<!-- ngx-datatable -->
<ngx-datatable [rows]="employees" [columns]="columns">
  <ngx-datatable-column name="Status" prop="status">
    <ng-template let-value="value">
      <app-status-badge [status]="value"></app-status-badge>
    </ng-template>
  </ngx-datatable-column>
</ngx-datatable>

<!-- @toolbox-web/grid -->
<tbw-grid [rows]="employees" [gridConfig]="config">
  <tbw-grid-column field="status" header="Status">
    <app-status-badge *tbwRenderer="let value" [status]="value" />
  </tbw-grid-column>
</tbw-grid>
```

---

## Common Patterns

### Custom Cell Renderers

```typescript
// Vanilla - return HTMLElement or string
{
  field: 'status',
  renderer: (ctx) => {
    const span = document.createElement('span');
    span.className = `badge badge-${ctx.value}`;
    span.textContent = ctx.value;
    return span;
  },
}

// React - return JSX
{
  field: 'status',
  renderer: (ctx) => (
    <span className={`badge badge-${ctx.value}`}>{ctx.value}</span>
  ),
}

// Angular - use structural directive
<tbw-grid-column field="status">
  <span *tbwRenderer="let value" [class]="'badge badge-' + value">{{ value }}</span>
</tbw-grid-column>
```

### Custom Cell Editors

```typescript
// Vanilla
{
  field: 'status',
  editable: true,
  editor: (ctx) => {
    const select = document.createElement('select');
    ['active', 'inactive'].forEach(opt => {
      const option = document.createElement('option');
      option.value = opt;
      option.textContent = opt;
      option.selected = opt === ctx.value;
      select.appendChild(option);
    });
    select.addEventListener('change', () => ctx.commit(select.value));
    select.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') ctx.cancel();
    });
    return select;
  },
}

// React
{
  field: 'status',
  editable: true,
  editor: (ctx) => (
    <select
      defaultValue={ctx.value}
      onChange={(e) => ctx.commit(e.target.value)}
      onKeyDown={(e) => e.key === 'Escape' && ctx.cancel()}
      autoFocus
    >
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>
  ),
}
```

### Server-Side Data Loading

The `ServerSidePlugin` enables **virtual scrolling with lazy loading** from a remote API. It's designed for large datasets (10k+ rows) where loading all data upfront is impractical.

**Key Features:**
- Block-based data fetching (loads only visible rows + buffer)
- LRU cache for previously loaded blocks
- Automatic prefetching on scroll
- Integration with server-side sorting and filtering
- Loading placeholders for pending data

```typescript
import { ServerSidePlugin } from '@toolbox-web/grid/plugins/server-side';

// 1. Create the plugin
const serverSide = new ServerSidePlugin({
  pageSize: 100,           // Rows per API request
  cacheBlockSize: 100,     // Cache block size
  maxConcurrentRequests: 2 // Parallel request limit
});

// 2. Add to grid config
grid.gridConfig = {
  columns: [...],
  plugins: [serverSide],
};

// 3. Set the data source after grid is ready
grid.ready().then(() => {
  serverSide.setDataSource({
    async getRows(params) {
      // params: { startRow, endRow, sortModel, filterModel }
      const response = await fetch('/api/employees', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          start: params.startRow,
          end: params.endRow,
          sort: params.sortModel,
          filter: params.filterModel,
        }),
      });
      const { rows, total } = await response.json();
      return {
        rows,
        totalRowCount: total, // Required for scroll height calculation
      };
    },
  });
});
```

**Server-Side Sorting:**

For sorting large datasets on the server, use `sortHandler` at the grid config level:

```typescript
grid.gridConfig = {
  columns: [...],
  plugins: [serverSide],
  sortHandler: async (rows, sortState, columns) => {
    // sortState: { field: 'name', direction: 1 } // 1=asc, -1=desc
    const response = await fetch(
      `/api/employees?sort=${sortState.field}&dir=${sortState.direction === 1 ? 'asc' : 'desc'}`
    );
    return response.json();
  },
};
```

**Server-Side Filtering:**

Use FilteringPlugin's async handlers for server-side filtering:

```typescript
import { FilteringPlugin } from '@toolbox-web/grid/plugins/filtering';

const filtering = new FilteringPlugin({
  filterHandler: async (rows, filterState) => {
    const response = await fetch('/api/employees/filter', {
      method: 'POST',
      body: JSON.stringify(filterState),
    });
    return response.json();
  },
});
```

**Programmatic API:**

```typescript
const plugin = grid.getPlugin(ServerSidePlugin);

plugin.refresh();           // Reload current viewport from server
plugin.purgeCache();        // Clear all cached blocks
plugin.getTotalRowCount();  // Get server-reported total
plugin.isRowLoaded(index);  // Check if row is in cache
```
```

### Row Grouping with Aggregations

```typescript
import { RowGroupingPlugin } from '@toolbox-web/grid/plugins/grouping-rows';

gridConfig: {
  columns: [
    { field: 'department', header: 'Department' },
    { field: 'name', header: 'Name' },
    { field: 'salary', header: 'Salary', type: 'number', aggregator: 'sum' },
  ],
  plugins: [
    new RowGroupingPlugin({
      groupBy: ['department'],
      expanded: true, // Start expanded
    }),
  ],
}
```

### Responsive Layout (Mobile Card Mode)

```typescript
import { ResponsivePlugin } from '@toolbox-web/grid/plugins/responsive';

// Basic: Switch to card layout below 600px
gridConfig: {
  plugins: [
    new ResponsivePlugin({ breakpoint: 600 }),
  ],
}

// Advanced: Progressive degradation with multiple breakpoints
gridConfig: {
  plugins: [
    new ResponsivePlugin({
      breakpoints: [
        { maxWidth: 900, hiddenColumns: ['startDate'] },
        { maxWidth: 700, hiddenColumns: ['startDate', 'email'] },
        { maxWidth: 500, cardLayout: true },
      ],
      animate: true, // Smooth transitions (default)
    }),
  ],
}

// Value-only columns: Hide label but show value in cards
gridConfig: {
  plugins: [
    new ResponsivePlugin({
      breakpoint: 600,
      hiddenColumns: [
        'startDate',                           // Fully hidden
        { field: 'email', showValue: true },   // Value only, no label
      ],
    }),
  ],
}

// Custom card renderer for complete control
gridConfig: {
  plugins: [
    new ResponsivePlugin({
      breakpoint: 600,
      cardRenderer: (row) => {
        const card = document.createElement('div');
        card.className = 'employee-card';
        card.innerHTML = `
          <div class="name">${row.name}</div>
          <div class="email">${row.email}</div>
        `;
        return card;
      },
    }),
  ],
}
```

### Theming

```css
/* Override CSS custom properties */
tbw-grid {
  --tbw-color-bg: #ffffff;
  --tbw-color-fg: #333333;
  --tbw-color-border: #e0e0e0;
  --tbw-color-header-bg: #f5f5f5;
  --tbw-color-row-hover: #f0f7ff;
  --tbw-color-row-selected: #e3f2fd;
  --tbw-color-accent: #1976d2;
}

/* Scale the entire grid */
tbw-grid.large {
  font-size: 1.25em;
}

tbw-grid.compact {
  font-size: 0.875em;
}
```

### CSS Variable Reference

All CSS custom properties use the `--tbw-` prefix. Variables use em units so everything scales proportionally with font size.

#### Core Variables (grid.css)

**Base Design Tokens:**
- `--tbw-base-icon-size: 1em` - Base icon size (icons scale with font)
- `--tbw-base-radius: 0.25em` - Base border radius
- `--tbw-font-size: 1em` - Base font size
- `--tbw-font-size-sm: 0.9285em` - Small font size
- `--tbw-font-size-xs: 0.7857em` - Extra small font size
- `--tbw-font-size-2xs: 0.7142em` - Extra extra small font size

**Spacing Scale:**
- `--tbw-spacing-xs: 0.25em` - ~4px at 16px font
- `--tbw-spacing-sm: 0.375em` - ~6px
- `--tbw-spacing-md: 0.5em` - ~8px
- `--tbw-spacing-lg: 0.75em` - ~12px
- `--tbw-spacing-xl: 1em` - ~16px

**Icon Sizes:**
- `--tbw-icon-size` - Standard icon size
- `--tbw-icon-size-sm: 0.875em` - Small icon size
- `--tbw-checkbox-size` - Checkbox size
- `--tbw-toggle-size: 1.25em` - Toggle button size

**Core Palette (use light-dark() for automatic theme support):**
- `--tbw-color-bg: transparent` - Grid background
- `--tbw-color-panel-bg` - Panel/popup background
- `--tbw-color-fg` - Foreground/text color
- `--tbw-color-fg-muted` - Muted/secondary text
- `--tbw-color-accent` - Accent/primary color
- `--tbw-color-accent-fg` - Text on accent background
- `--tbw-color-success` - Success state color
- `--tbw-color-error` - Error state color
- `--tbw-color-selection` - Selected row background
- `--tbw-color-row-alt` - Alternating row background
- `--tbw-color-row-hover` - Row hover background
- `--tbw-color-header-bg` - Header background
- `--tbw-color-header-fg` - Header text color
- `--tbw-color-border` - Default border color
- `--tbw-color-border-strong` - Emphasized border color
- `--tbw-color-border-cell` - Cell border color
- `--tbw-color-border-header` - Header border color
- `--tbw-color-shadow` - Shadow color for dropdowns/panels

**Cell & Row Dimensions:**
- `--tbw-cell-padding-header` - Header cell padding
- `--tbw-cell-padding` - Cell padding
- `--tbw-row-height: 1.75em` - ~28px at 16px font
- `--tbw-header-height: 1.875em` - ~30px at 16px font

**Borders:**
- `--tbw-border-radius` - Border radius for elements
- `--tbw-border-input` - Input field border
- `--tbw-border-header` - Header bottom border
- `--tbw-row-divider` - Row separator line
- `--tbw-color-active-row-bg` - Active/focused row background

**Focus & Selection:**
- `--tbw-focus-outline` - Focus ring style
- `--tbw-focus-outline-offset` - Focus ring offset
- `--tbw-focus-background` - Focused cell background
- `--tbw-range-border-color` - Range selection border
- `--tbw-range-selection-bg` - Range selection background

**Resize Handle:**
- `--tbw-resize-handle-width` - Width of resize grab area
- `--tbw-resize-handle-color` - Resize handle color (transparent by default)
- `--tbw-resize-handle-color-hover` - Resize handle hover color
- `--tbw-resize-indicator-width: 2px` - Resize indicator line width
- `--tbw-resize-indicator-color` - Resize indicator color

**Animation:**
- `--tbw-transition-duration: 120ms` - Quick transitions
- `--tbw-animation-duration: 200ms` - Standard animations
- `--tbw-animation-easing: ease-out` - Animation curve
- `--tbw-animation-enabled: 1` - Enable/disable animations (0 or 1)
- `--tbw-row-change-duration: 500ms` - Row update highlight
- `--tbw-row-insert-duration: 300ms` - Row insert animation
- `--tbw-row-remove-duration: 200ms` - Row remove animation
- `--tbw-row-change-color` - Row change highlight color

**Sorting Indicators:**
- `--tbw-sort-indicator-color` - Default sort icon color
- `--tbw-sort-indicator-active-color` - Active sort icon color
- `--tbw-sort-indicator-display: inline-flex` - Sort indicator display property (set to `none` to hide by default, reveals on hover/active)
- `--tbw-sort-indicator-visibility: visible` - Show/hide sort indicators

**Tool Panel & Shell:**
- `--tbw-shell-header-height: 2.75em` - Shell header height
- `--tbw-shell-header-bg` - Shell header background
- `--tbw-tool-panel-width: 17.5em` - Tool panel width
- `--tbw-tool-panel-bg` - Tool panel background

**Component Shortcuts (commonly overridden):**
- `--tbw-panel-padding` - Padding for panels/popups
- `--tbw-panel-gap` - Gap between panel items
- `--tbw-button-padding` - Button padding
- `--tbw-button-padding-sm` - Small button padding
- `--tbw-input-height` - Input field height
- `--tbw-input-padding` - Input field padding
- `--tbw-menu-item-padding` - Menu item padding

#### Plugin-Specific Variables

**FilteringPlugin (filtering.css, FilteringPlugin.css):**
- `--tbw-filter-btn-display: inline-flex` - Filter button display
- `--tbw-filter-btn-visibility: visible` - Filter button visibility
- `--tbw-filter-btn-padding` - Filter button padding
- `--tbw-filter-btn-font-weight: 500` - Filter button font weight
- `--tbw-filter-btn-min-height: auto` - Filter button min height
- `--tbw-filter-accent` - Filter accent color (falls back to --tbw-color-accent)
- `--tbw-filter-panel-bg` - Filter panel background
- `--tbw-filter-panel-fg` - Filter panel text color
- `--tbw-filter-panel-border` - Filter panel border
- `--tbw-filter-panel-radius` - Filter panel border radius
- `--tbw-filter-panel-shadow` - Filter panel shadow
- `--tbw-filter-search-padding` - Search input padding
- `--tbw-filter-input-bg` - Filter input background
- `--tbw-filter-input-border` - Filter input border
- `--tbw-filter-input-radius` - Filter input border radius
- `--tbw-filter-item-height: 28px` - Filter value list item height
- `--tbw-filter-hover` - Filter item hover background
- `--tbw-filter-divider` - Divider line color
- `--tbw-filter-muted` - Muted text color in panel
- `--tbw-indicator-size: 0.375rem` - Active filter dot size

**SelectionPlugin (selection.css):**
- `--tbw-focus-background` - Focused cell background
- `--tbw-range-selection-bg` - Range selection background
- `--tbw-range-border-color` - Range selection border
- `--tbw-color-warning-bg` - Invalid paste feedback color

**TreePlugin (tree.css):**
- `--tbw-tree-depth` - Current nesting depth (set per row)
- `--tbw-tree-indent-width` - Indent per depth level
- `--tbw-tree-toggle-size: 1.25em` - Expand/collapse button size
- `--tbw-tree-accent` - Tree toggle accent color

**VisibilityPlugin (visibility.css):**
- `--tbw-visibility-hover` - Item hover background
- `--tbw-visibility-border` - Panel border color
- `--tbw-visibility-btn-bg` - Toggle button background
- `--tbw-reorder-indicator` - Drag indicator color

**ReorderPlugin (reorder.css):**
- `--tbw-reorder-indicator` - Drop indicator color

**RowReorderPlugin (row-reorder.css):**
- `--tbw-color-bg-selected` - Dragged row background

**PivotPlugin (pivot.css):**
- `--tbw-pivot-group-bg` - Group row background
- `--tbw-pivot-group-hover` - Group row hover
- `--tbw-pivot-leaf-bg` - Leaf row background
- `--tbw-pivot-grand-total-bg` - Grand total row background
- `--tbw-pivot-toggle-color` - Toggle button color
- `--tbw-pivot-toggle-hover-bg` - Toggle button hover background
- `--tbw-pivot-count-color` - Row count text color
- `--tbw-pivot-border` - Section border color
- `--tbw-pivot-section-bg` - Config panel section background
- `--tbw-pivot-header-bg` - Config panel header background
- `--tbw-pivot-drop-border` - Drop zone border color
- `--tbw-pivot-drop-bg` - Drop zone background
- `--tbw-pivot-drop-active` - Active drop zone background
- `--tbw-pivot-chip-bg` - Field chip background
- `--tbw-pivot-chip-border` - Field chip border
- `--tbw-pivot-chip-hover` - Field chip hover background
- `--tbw-pivot-chip-remove-hover-bg` - Remove button hover background
- `--tbw-pivot-chip-remove-hover-fg` - Remove button hover text color
- `--tbw-pivot-depth` - Indentation depth level

**ResponsivePlugin (responsive.css):**
- `--tbw-responsive-duration: 200ms` - Mode transition duration

### Icon Customization

Override grid icons via `gridConfig.icons`:

```typescript
gridConfig: {
  icons: {
    sortAsc: '<svg>...</svg>',      // Sort ascending indicator
    sortDesc: '<svg>...</svg>',     // Sort descending indicator
    expand: '▶',                    // Expand icon (trees, groups)
    collapse: '▼',                  // Collapse icon
    filter: '<svg>...</svg>',       // Filter button in headers
    filterActive: '<svg>...</svg>', // Filter button when active
    dragHandle: '⋮⋮',               // Row/column drag handle
    toolPanel: '☰',                 // Tool panel toggle
  },
}
```

### Built-in Themes

```typescript
// Import a pre-built theme
import '@toolbox-web/themes/dg-theme-material.css';
// or
import '@toolbox-web/themes/dg-theme-bootstrap.css';
// or
import '@toolbox-web/themes/dg-theme-vibrant.css';
```

### Accessibility

The grid follows the W3C WAI-ARIA Grid Pattern for interactive data grids.

**ARIA Label Configuration:**

```typescript
gridConfig: {
  gridAriaLabel: 'Employee directory',        // Sets aria-label on grid
  gridAriaDescribedBy: 'grid-description',    // Sets aria-describedby (ID reference)
  shell: { header: { title: 'Team Members' }}, // Auto-used as aria-label if gridAriaLabel not set
}
```

**Built-in ARIA Attributes:**
- `role="grid"` on data container, `role="row"` and `role="gridcell"` on cells
- `role="columnheader"` on header cells
- `aria-rowcount` / `aria-colcount` for total counts
- `aria-rowindex` / `aria-colindex` on each cell
- `aria-sort` on sortable headers (none/ascending/descending)
- `aria-selected` on focused/selected cells
- `aria-readonly` on non-editable cells (with EditingPlugin)
- `aria-checked` on boolean cells

---

## Key Differences from Other Grids

1. **Web Component First**: Works in any framework without wrappers. React/Angular adapters are optional enhancements.

2. **Plugin Architecture**: Core bundle is lightweight (~30KB). Add features via plugins for optimal tree-shaking.

3. **Single Source of Truth**: All configuration converges to `effectiveConfig`. No conflicting state.

4. **Light DOM**: Uses light DOM for CSS cascade and accessibility. No Shadow DOM isolation issues.

5. **Em-Based Sizing**: Change `font-size` to scale the entire grid proportionally.

6. **Opt-in Editing**: `EditingPlugin` required for inline editing. Prevents accidental edits and keeps core small.

7. **Row Virtualization**: Built-in virtualization for 100k+ rows. No extra configuration needed.

---

## Troubleshooting

### "Configuration error: Column uses 'editable' but EditingPlugin not loaded"

Add the EditingPlugin to enable editing:

```typescript
import { EditingPlugin } from '@toolbox-web/grid/plugins/editing';

gridConfig: {
  plugins: [new EditingPlugin()],
}
```

### Grid not rendering / empty

1. Ensure the grid has a fixed height:
```css
tbw-grid { height: 400px; display: block; }
```

2. Wait for component registration:
```typescript
await customElements.whenDefined('tbw-grid');
```

### React renderers not working

Use `ReactGridConfig` type and `DataGrid` component from `@toolbox-web/grid-react`:

```tsx
import { DataGrid, type ReactGridConfig } from '@toolbox-web/grid-react';

const config: ReactGridConfig<T> = {
  columns: [
    { field: 'x', renderer: (ctx) => <MyComponent value={ctx.value} /> },
  ],
};
```

### Angular templates not rendering

Import the `Grid` directive and use `CUSTOM_ELEMENTS_SCHEMA`:

```typescript
@Component({
  imports: [Grid, TbwRenderer],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
})
```

---

## Resources

- [Storybook Documentation](https://toolboxjs.com/): Interactive examples
- [GitHub Repository](https://github.com/OysteinAmundsen/toolbox): Source code
- [npm Package](https://www.npmjs.com/package/@toolbox-web/grid): Installation
- [Changelog](https://github.com/OysteinAmundsen/toolbox/blob/main/libs/grid/CHANGELOG.md): Version history
