import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as ReorderStories from './reorder.stories';

<Meta of={ReorderStories} />

# Column Reorder Plugin

The Reorder plugin lets users rearrange columns by dragging and dropping column headers. Supports smooth FLIP animations, fade transitions, or instant reordering depending on your preference.

## Installation

```ts
import { ReorderPlugin } from '@toolbox-web/grid/plugins/reorder';
```

## Basic Usage

Just add the plugin and columns become draggable. Users can grab any column header and drop it in a new position. The plugin handles visual feedback and smooth animations automatically.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'id', header: 'ID' },
    { field: 'name', header: 'Name' },
    { field: 'email', header: 'Email' },
    { field: 'department', header: 'Department' },
  ],
  plugins: [
    new ReorderPlugin({
      animation: 'flip',
      animationDuration: 200,
    }),
  ],
};

// Listen for column moves
grid.addEventListener('column-move', (e) => {
  console.log(`Moved ${e.detail.field} from ${e.detail.fromIndex} to ${e.detail.toIndex}`);
});
```
  </Tab>
  <Tab label="React">
```tsx
import '@toolbox-web/grid-react/features/reorder';
import { DataGrid } from '@toolbox-web/grid-react';

function MyGrid({ data }) {
  return (
    <DataGrid
      rows={data}
      columns={[
        { field: 'id', header: 'ID' },
        { field: 'name', header: 'Name' },
        { field: 'email', header: 'Email' },
        { field: 'department', header: 'Department' },
      ]}
      reorder={{ animation: 'flip' }}
      onColumnMove={(e) => console.log(`Moved ${e.detail.field} from ${e.detail.fromIndex} to ${e.detail.toIndex}`)}
    />
  );
}
```
  </Tab>
  <Tab label="Vue">
```vue
<template>
  <tbw-grid ref="gridRef" @column-move="onColumnMove" />
</template>

<script setup>
import { ref, onMounted } from 'vue';
import '@toolbox-web/grid';
import { ReorderPlugin } from '@toolbox-web/grid/plugins/reorder';

const props = defineProps(['data']);
const gridRef = ref(null);

onMounted(() => {
  gridRef.value.gridConfig = {
    columns: [
      { field: 'id', header: 'ID' },
      { field: 'name', header: 'Name' },
      { field: 'email', header: 'Email' },
      { field: 'department', header: 'Department' },
    ],
    plugins: [new ReorderPlugin({ animation: 'flip' })],
  };
  gridRef.value.rows = props.data;
});

const onColumnMove = (e) => {
  console.log('Column moved:', e.detail);
};
</script>
```
  </Tab>
  <Tab label="Angular">
```typescript
// Feature import - enables the [reorder] input
import '@toolbox-web/grid-angular/features/reorder';

import { Component, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { Grid } from '@toolbox-web/grid-angular';
import type { ColumnConfig } from '@toolbox-web/grid';

@Component({
  selector: 'app-my-grid',
  imports: [Grid],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <tbw-grid
      [rows]="rows"
      [columns]="columns"
      [reorder]="{ animation: 'flip' }"
      (column-move)="onColumnMove($event)"
      style="height: 400px; display: block;">
    </tbw-grid>
  `,
})
export class MyGridComponent {
  rows = [...];

  columns: ColumnConfig[] = [
    { field: 'id', header: 'ID' },
    { field: 'name', header: 'Name' },
    { field: 'email', header: 'Email' },
    { field: 'department', header: 'Department' },
  ];

  onColumnMove(e: CustomEvent) {
    console.log(`Moved ${e.detail.field} from ${e.detail.fromIndex} to ${e.detail.toIndex}`);
  }
}
```
  </Tab>
</Tabs>

## Demos

### Default Reorder

Drag column headers to reorder them. Use the controls below to experiment with different animation types and durations.

<Canvas of={ReorderStories.Default} withToolbar />
<Controls of={ReorderStories.Default} />

## Configuration Options

| Option              | Type                        | Default  | Description                                                               |
| ------------------- | --------------------------- | -------- | ------------------------------------------------------------------------- |
| `animation`         | `false \| 'flip' \| 'fade'` | `'flip'` | Animation type: `false` (instant), `'flip'` (slide), `'fade'` (crossfade) |
| `animationDuration` | `number`                    | `200`    | Animation duration in ms (applies to FLIP animation)                      |

### Animation Examples

```ts
// No animation - instant reorder
new ReorderPlugin({ animation: false });

// FLIP animation with custom duration
new ReorderPlugin({ animation: 'flip', animationDuration: 300 });

// View Transitions API fade effect
new ReorderPlugin({ animation: 'fade' });
```

## Events

| Event         | Detail                                        | Cancelable | Description                                       |
| ------------- | --------------------------------------------- | ---------- | ------------------------------------------------- |
| `column-move` | `{ field, fromIndex, toIndex, columnOrder }` | Yes        | Fired when a column move is attempted. Call `preventDefault()` to block the move. |

## Keyboard Support

| Key       | Action                    |
| --------- | ------------------------- |
| `Alt + ←` | Move focused column left  |
| `Alt + →` | Move focused column right |
