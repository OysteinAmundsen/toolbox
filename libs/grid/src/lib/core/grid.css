/**
 * tbw-grid Light DOM Styles
 *
 * This stylesheet uses CSS nesting to scope all styles to the tbw-grid element.
 * All selectors are automatically prefixed with `tbw-grid` for encapsulation.
 *
 * CSS Cascade Layers are used to control style priority:
 * - tbw-base: Core grid styles (lowest priority)
 * - tbw-plugins: Plugin styles (override base)
 * - tbw-theme: Theme overrides (override plugins)
 * - Unlayered CSS: User customizations (highest priority - always wins)
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_nesting
 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/@layer
 */

/* Declare layer order - earlier layers have lower priority */
@layer tbw-base, tbw-plugins, tbw-theme;

@layer tbw-base {
  :root {
    color-scheme: light dark;
  }

  /* ============================================================================
     Main Grid Element
     ============================================================================
     All styles are nested inside tbw-grid for automatic scoping.
     ============================================================================ */

  tbw-grid {
    /* ========== CSS Custom Properties ========== */

    /* ========== Base Design Tokens ========== */
    /* Override these for bulk changes. Uses em units so everything
       scales proportionally with font size. */

    --tbw-base-icon-size: 1em; /* Icons scale with font */
    --tbw-base-radius: 0.25em; /* Border radius */

    /* ========== Typography ========== */
    /* All em-based, relative to inherited font size */
    --tbw-font-size: 1em;
    --tbw-font-size-sm: 0.9285em;
    --tbw-font-size-xs: 0.7857em;
    --tbw-font-size-2xs: 0.7142em;

    /* ========== Spacing Scale ========== */
    /* Em-based spacing scales with font size */
    --tbw-spacing-xs: 0.25em; /* ~4px at 16px font */
    --tbw-spacing-sm: 0.375em; /* ~6px */
    --tbw-spacing-md: 0.5em; /* ~8px */
    --tbw-spacing-lg: 0.75em; /* ~12px */
    --tbw-spacing-xl: 1em; /* ~16px */

    /* ========== Icon Sizes ========== */
    --tbw-icon-size: var(--tbw-base-icon-size);
    --tbw-icon-size-sm: 0.875em;
    --tbw-checkbox-size: var(--tbw-base-icon-size);
    --tbw-toggle-size: 1.25em;

    /* ========== Border Radius ========== */
    --tbw-border-radius: var(--tbw-base-radius);

    /* ========== Core Palette ========== */
    /* Colors use light-dark() for automatic theme support */
    --tbw-color-bg: transparent;
    --tbw-color-panel-bg: light-dark(#eeeeee, #222222);
    --tbw-color-fg: light-dark(#222222, #eeeeee);
    --tbw-color-fg-muted: light-dark(#555555, #aaaaaa);
    --tbw-color-accent: light-dark(#3b82f6, #3b82f6);
    --tbw-color-accent-fg: light-dark(#ffffff, #000000);
    --tbw-color-success: light-dark(hsl(122, 39%, 40%), hsl(122, 39%, 49%));
    --tbw-color-error: light-dark(hsl(0, 65%, 51%), hsl(0, 65%, 55%));
    --tbw-color-selection: light-dark(#fff7d6, #333333);
    --tbw-color-row-alt: var(--tbw-color-bg);
    --tbw-color-row-hover: light-dark(#f0f6ff, #1c1c1c);
    --tbw-color-header-bg: color-mix(in hsl, var(--tbw-color-panel-bg) 85%, var(--tbw-color-fg));
    --tbw-color-header-fg: color-mix(in hsl, var(--tbw-color-fg) 75%, var(--tbw-color-panel-bg));
    --tbw-color-border: light-dark(#d0d0d4, #454545);
    --tbw-color-border-strong: light-dark(#777777, #666666);
    --tbw-color-border-cell: var(--tbw-color-border);
    --tbw-color-border-header: var(--tbw-color-border);
    --tbw-color-shadow: light-dark(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.3));

    /* ========== Typography (derived from base) ========== */
    --tbw-font-family: inherit;
    --tbw-font-size-header: var(--tbw-font-size);
    --tbw-font-weight-header: bold;

    /* ========== Cell & Row Dimensions ========== */
    --tbw-cell-padding-header: var(--tbw-spacing-xs) var(--tbw-spacing-md);
    --tbw-cell-padding: var(--tbw-spacing-xs) var(--tbw-spacing-md);
    --tbw-cell-padding-input: var(--tbw-spacing-xs) var(--tbw-spacing-sm);
    --tbw-row-height: 1.75em; /* ~28px at 16px font */
    --tbw-header-height: 1.875em; /* ~30px at 16px font */
    --tbw-cell-white-space: nowrap;

    /* ========== Borders ========== */
    --tbw-border-input: 1px solid var(--tbw-color-border-strong);
    --tbw-border-header: 1px solid var(--tbw-color-border-header);
    --tbw-row-divider: 1px solid var(--tbw-color-border-cell);
    --tbw-row-hover-outline: 0;
    --tbw-color-active-row-bg: var(--tbw-color-selection);
    --tbw-active-row-outline: 0;

    /* ========== Focus & Outline ========== */
    --tbw-focus-outline: 2px solid var(--tbw-color-accent);
    --tbw-focus-outline-offset: -2px;
    --tbw-focus-background: rgba(from var(--tbw-color-accent) r g b / 12%);

    /* Range/row selection */
    --tbw-range-border-color: var(--tbw-color-accent);
    --tbw-range-selection-bg: rgba(from var(--tbw-range-border-color) r g b / 12%);

    /* ========== Resize Handle ========== */
    --tbw-resize-handle-width: var(--tbw-spacing-sm);
    --tbw-resize-handle-color: transparent;
    --tbw-resize-handle-color-hover: var(--tbw-color-accent);
    --tbw-resize-handle-border-radius: 0;
    --tbw-resize-indicator-width: 2px;
    --tbw-resize-indicator-color: var(--tbw-color-accent);
    --tbw-resize-indicator-opacity: 0.6;

    /* ========== Scrollbar ========== */
    --tbw-scrollbar-thumb: var(--tbw-color-border-strong);
    --tbw-scrollbar-track: var(--tbw-color-bg);

    /* ========== Animation / Transitions ========== */
    --tbw-transition-duration: 120ms;
    --tbw-transition-ease: ease;
    --tbw-animation-duration: 200ms;
    --tbw-animation-easing: ease-out;
    --tbw-animation-enabled: 1;

    /* Row animations (change/insert/remove) */
    --tbw-row-change-duration: 500ms;
    --tbw-row-insert-duration: 300ms;
    --tbw-row-remove-duration: 200ms;
    --tbw-row-change-color: rgba(from var(--tbw-color-accent) r g b / 25%);

    /* ========== Sorting Indicators ========== */
    --tbw-sort-indicator-color: var(--tbw-color-fg-muted);
    --tbw-sort-indicator-active-color: var(--tbw-color-accent);

    /* ========== Column Headers ========== */
    --tbw-header-text-transform: none;
    --tbw-header-letter-spacing: normal;
    --tbw-color-header-separator: var(--tbw-color-border-cell);

    /* ========== Density Scaling ========== */
    --tbw-density-scale: 1;

    /* ========== Shell Header ========== */
    --tbw-shell-header-height: 2.75em; /* ~44px at 16px font */
    --tbw-shell-header-bg: var(--tbw-color-panel-bg);
    --tbw-shell-header-border: var(--tbw-color-border);
    --tbw-shell-title-font-size: var(--tbw-font-size);
    --tbw-shell-title-font-weight: 600;

    /* ========== Tool Panel ========== */
    --tbw-tool-panel-width: 17.5em; /* ~280px at 16px font */
    --tbw-tool-panel-bg: var(--tbw-color-panel-bg);
    --tbw-tool-panel-border: var(--tbw-color-border);
    --tbw-tool-panel-header-height: 2.5em; /* ~40px at 16px font */
    --tbw-tool-panel-transition: var(--tbw-animation-duration) var(--tbw-animation-easing);

    /* ========== Toolbar ========== */
    --tbw-toolbar-button-size: 2em; /* ~32px at 16px font */
    --tbw-toolbar-button-gap: var(--tbw-spacing-xs);

    /* ========== Component Shortcuts ========== */
    --tbw-panel-padding: var(--tbw-spacing-lg);
    --tbw-panel-gap: var(--tbw-spacing-md);
    --tbw-menu-item-padding: var(--tbw-spacing-sm) var(--tbw-spacing-lg);
    --tbw-menu-item-gap: var(--tbw-spacing-md);
    --tbw-menu-min-width: 10rem; /* ~160px */
    --tbw-button-padding: var(--tbw-spacing-sm) var(--tbw-spacing-lg);
    --tbw-button-padding-sm: var(--tbw-spacing-xs) var(--tbw-spacing-md);
    --tbw-input-height: var(--tbw-row-height);
    --tbw-input-padding: 0 var(--tbw-spacing-md);
    --tbw-detail-padding: var(--tbw-spacing-xl);
    --tbw-detail-max-height: 31.25rem; /* ~500px */
    --tbw-indicator-size: var(--tbw-spacing-sm);

    /* ========== Element Styles ========== */

    position: relative;
    display: block;
    width: 100%;
    height: 100%;
    min-height: 0;
    contain: content;
    font-family: var(--tbw-font-family);
    font-size: var(--tbw-font-size);
    background: var(--tbw-color-bg);
    color: var(--tbw-color-fg);
    border: 1px solid var(--tbw-color-border);
    border-radius: var(--tbw-border-radius);
    overflow: clip;
    outline: none;

    /* Box sizing for all descendants */
    &,
    & * {
      box-sizing: border-box;
    }

    /* ========== Header ========== */

    .header {
      display: block;
      flex-shrink: 0;
      z-index: var(--tbw-z-layer-header, 30);
      background: var(--tbw-color-header-bg);
      overflow: visible;
    }

    .header-group-row {
      display: grid;
      grid-template-columns: var(--tbw-column-template);
      background: var(--tbw-color-header-bg);
      z-index: var(--tbw-z-layer-header, 30);
    }

    .header-group-cell {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: var(--tbw-cell-padding-header, 2px 8px);
      color: var(--tbw-color-header-group-fg, var(--tbw-color-header-fg));
      font-weight: var(--tbw-font-weight-header-group, var(--tbw-font-weight-header));
      justify-content: var(--tbw-align-header-group, var(--tbw-align-header, flex-start));

      &:not(:last-child) {
        border-right: 2px solid var(--tbw-color-border);
      }
    }

    .header-row {
      display: grid;
      grid-template-columns: var(--tbw-column-template);
      color: var(--tbw-color-header-fg);
      font-size: var(--tbw-font-size-header);
      min-height: var(--tbw-header-height);
      border-bottom: var(--tbw-border-header);
      z-index: var(--tbw-z-layer-header, 30);

      > .cell {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: var(--tbw-cell-padding-header, 2px 8px);
        background-color: var(--tbw-color-header-bg);
        font-weight: var(--tbw-font-weight-header);
        border-right: 1px solid var(--tbw-color-border-cell);
        /* overflow: visible allows resize handles to extend past cell boundary */
        overflow: visible;
        min-width: 0;

        > span:first-child {
          flex: 1;
          min-width: 0;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        > span[part~='sort-indicator'] {
          flex-shrink: 0;
          opacity: 0.6;
        }

        &:last-child {
          border-right: 0;
        }

        &.grouped.group-end:not(:last-child) {
          border-right: 2px solid var(--tbw-color-border);
        }

        &.resizable {
          position: relative;
        }

        &.sticky-left,
        &.sticky-right {
          background: var(--tbw-color-header-bg);
          z-index: 35;
        }
      }
    }

    /* ========== Grid Root Layout ========== */

    .tbw-grid-root {
      display: flex;
      flex-direction: column;
      height: 100%;

      &.has-shell {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
    }

    .rows-body-wrapper {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: row;
      width: 100%;
      min-width: fit-content;
    }

    .rows-body {
      flex: 1;
      min-width: 0;
      min-height: 0;
      display: flex;
      flex-direction: column;
      overflow: visible;
    }

    .rows-container {
      display: flex;
      flex-direction: row;
      flex: 1;
      min-height: 0;
      overflow: visible;
    }

    .rows-viewport {
      flex: 1;
      min-width: 0;
      position: relative;
      display: block;
      overflow: clip;

      .rows {
        position: absolute;
        top: 0;
        left: 0;
        min-width: 100%;
        will-change: transform;
        z-index: var(--tbw-z-layer-rows, 1);
      }
    }

    /* ========== Faux Scrollbar ========== */

    .faux-vscroll {
      position: sticky;
      inset-inline-end: 0;
      flex-shrink: 0;
      width: auto;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: var(--tbw-z-layer-header, 30);
    }

    .faux-vscroll-spacer {
      width: 1px;
    }

    /* ========== Data Rows ========== */

    .data-grid-row {
      display: grid;
      grid-template-columns: var(--tbw-column-template);
      contain: layout style;
      content-visibility: auto;
      contain-intrinsic-size: auto var(--tbw-row-height);

      &:nth-child(even) {
        background: var(--tbw-color-row-alt);
      }

      &:hover {
        background: var(--tbw-color-row-hover);
      }

      > .cell {
        display: block;
        padding: var(--tbw-cell-padding, 2px 8px);
        border-bottom: var(--tbw-row-divider);
        min-height: var(--tbw-row-height);
        line-height: calc(var(--tbw-row-height) - 5px);
        border-right: 1px solid var(--tbw-color-border-cell);
        overflow: hidden;
        min-width: 0;
        white-space: var(--tbw-cell-white-space, nowrap);
        text-overflow: ellipsis;

        > * {
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: inherit;
          min-width: 0;
        }

        &:last-child {
          border-right: 0;
        }

        &[data-type='boolean'] {
          text-align: center;

          input[type='checkbox'] {
            margin: 0;
            width: var(--tbw-checkbox-size);
            height: var(--tbw-checkbox-size);
            vertical-align: middle;
          }
        }

        &.selected:focus-visible,
        &:focus-visible:not(.cell-focus) {
          outline: none;
        }

        &.sticky-left,
        &.sticky-right {
          background: var(--tbw-color-panel-bg);
        }
      }
    }

    .selecting .data-grid-row > .cell {
      user-select: none;
    }

    /* ========== Sorting & Resize ========== */

    .sortable {
      cursor: pointer;
      user-select: none;
    }

    .resize-handle {
      position: absolute;
      top: 0;
      right: calc(var(--tbw-resize-handle-width) / -2);
      width: var(--tbw-resize-handle-width);
      height: 100%;
      cursor: e-resize;
      user-select: none;
      touch-action: none;
      z-index: 20;
      background: var(--tbw-resize-handle-color);
      transition: background 120ms ease;
      border-radius: var(--tbw-resize-handle-border-radius);

      /* Vertical line indicator extending through all rows on hover */
      &::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: var(--tbw-resize-indicator-width, 2px);
        height: 0;
        background: var(--tbw-resize-indicator-color, var(--tbw-color-accent));
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 120ms ease,
          height 0s 120ms;
        z-index: 1000;
      }

      &:hover {
        background: var(--tbw-resize-handle-color-hover);

        &::after {
          /* Extend to full grid height - uses viewport height as approximation */
          height: 100vh;
          opacity: var(--tbw-resize-indicator-opacity, 0.6);
          transition:
            opacity 120ms ease,
            height 0s;
        }
      }
    }

    /* ========== Focus Styling ========== */

    &[data-has-focus] {
      .cell-focus,
      .row-focus {
        outline: var(--tbw-focus-outline);
        outline-offset: var(--tbw-focus-outline-offset);
      }
    }

    /* ========== Sticky Columns ========== */

    .sticky-left,
    .sticky-right {
      position: sticky;
      z-index: 25;
    }

    .sticky-left {
      box-shadow: 1px 0 0 var(--tbw-color-border);
    }

    .sticky-right {
      box-shadow: -1px 0 0 var(--tbw-color-border);
    }

    /* ========== Shell Layout ========== */

    .tbw-shell-header {
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: var(--tbw-shell-header-height);
      padding: 0 8px;
      background: var(--tbw-shell-header-bg);
      border-bottom: 1px solid var(--tbw-shell-header-border);
      flex-shrink: 0;
    }

    .tbw-shell-title {
      font-size: var(--tbw-shell-title-font-size);
      font-weight: var(--tbw-shell-title-font-weight);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tbw-shell-content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
      overflow: hidden;
    }

    .tbw-shell-toolbar {
      display: flex;
      align-items: center;
      gap: var(--tbw-toolbar-button-gap);
      flex-shrink: 0;
    }

    .tbw-toolbar-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: var(--tbw-toolbar-button-size);
      height: var(--tbw-toolbar-button-size);
      padding: 0;
      border: 1px solid transparent;
      border-radius: var(--tbw-border-radius);
      background: transparent;
      color: var(--tbw-color-fg);
      cursor: pointer;
      font-size: 16px;
      transition:
        background var(--tbw-transition-duration) var(--tbw-transition-ease),
        border-color var(--tbw-transition-duration) var(--tbw-transition-ease);

      &:hover {
        background: var(--tbw-color-row-hover);
      }

      &:focus-visible {
        outline: var(--tbw-focus-outline);
        outline-offset: var(--tbw-focus-outline-offset);
      }

      &.active {
        background: var(--tbw-focus-background);
        border-color: var(--tbw-color-accent);
      }

      &:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
    }

    .tbw-toolbar-separator {
      width: 1px;
      height: 20px;
      background: var(--tbw-color-border);
      margin: 0 4px;
    }

    .tbw-shell-body {
      position: relative;
      display: flex;
      flex: 1;
      min-height: 0;
      overflow: visible;
    }

    .tbw-grid-content {
      flex: 1;
      min-width: 0;
      min-height: 0;
      display: flex;
      flex-direction: row;
      overflow: hidden;
    }

    .tbw-scroll-area {
      flex: 1;
      min-width: 0;
      min-height: 0;
      display: flex;
      flex-direction: column;
      overflow-x: auto;
      overflow-y: hidden;
      overflow-anchor: none;
    }

    /* ========== Tool Panel ========== */

    .tbw-tool-panel {
      position: absolute;
      top: 0;
      bottom: 0;
      right: 0;
      width: 0;
      overflow: hidden;
      background: var(--tbw-tool-panel-bg);
      border-left: 1px solid var(--tbw-tool-panel-border);
      transition: width var(--tbw-tool-panel-transition);
      display: flex;
      flex-direction: column;
      z-index: 30;
      box-shadow: -2px 0 8px var(--tbw-color-shadow);

      &[data-position='left'] {
        right: auto;
        left: 0;
        border-left: none;
        border-right: 1px solid var(--tbw-tool-panel-border);
        box-shadow: 2px 0 8px var(--tbw-color-shadow);
      }

      &.open {
        width: var(--tbw-tool-panel-width);
      }
    }

    .tbw-tool-panel-resize {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 6px;
      cursor: col-resize;
      background: transparent;
      z-index: 10;
      transition: background var(--tbw-transition-duration) var(--tbw-transition-ease);

      &[data-handle-position='left'] {
        left: 0;
      }

      &[data-handle-position='right'] {
        right: 0;
      }

      &:hover,
      &.resizing {
        background: var(--tbw-color-accent);
      }
    }

    .tbw-tool-panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: var(--tbw-tool-panel-header-height);
      padding: 0 12px;
      border-bottom: 1px solid var(--tbw-tool-panel-border);
      flex-shrink: 0;
    }

    .tbw-tool-panel-title {
      font-weight: 600;
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tbw-tool-panel-close {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      padding: 0;
      border: none;
      border-radius: var(--tbw-border-radius);
      background: transparent;
      color: var(--tbw-color-fg-muted);
      cursor: pointer;
      font-size: 14px;

      &:hover {
        background: var(--tbw-color-row-hover);
        color: var(--tbw-color-fg);
      }
    }

    .tbw-tool-panel-content {
      flex: 1;
      overflow: auto;
    }

    /* ========== Accordion ========== */

    .tbw-accordion {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .tbw-accordion-section {
      border-bottom: 1px solid var(--tbw-tool-panel-border);

      &:last-child {
        border-bottom: none;
      }

      &.single .tbw-accordion-header {
        cursor: default;

        &:hover {
          background: transparent;
        }
      }

      &.expanded {
        .tbw-accordion-chevron {
          transform: rotate(90deg);
        }

        .tbw-accordion-content {
          display: block;
        }
      }
    }

    .tbw-accordion-header {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 10px 12px;
      border: none;
      background: transparent;
      color: var(--tbw-color-fg);
      font-size: 13px;
      font-weight: 600;
      text-align: left;
      cursor: pointer;
      user-select: none;

      &:hover {
        background: var(--tbw-color-row-hover);
      }
    }

    .tbw-accordion-chevron {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      font-size: 10px;
      color: var(--tbw-color-fg-muted);
      transition: transform 0.15s ease;
      flex-shrink: 0;
    }

    .tbw-accordion-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      font-size: 14px;
      flex-shrink: 0;
    }

    .tbw-accordion-title {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .tbw-accordion-content {
      display: none;
    }

    /* ========== Animation Classes ========== */

    .tbw-expanding {
      animation: tbw-expand var(--tbw-animation-duration) var(--tbw-animation-easing) forwards;
      overflow: hidden;
    }

    .tbw-collapsing {
      animation: tbw-collapse var(--tbw-animation-duration) var(--tbw-animation-easing) forwards;
      overflow: hidden;
    }

    /* ========== Animation Mode Attributes ========== */

    &[data-animation-mode='off'] {
      --tbw-animation-enabled: 0;
      --tbw-animation-duration: 0ms;
    }
  }

  /* ============================================================================
   Media Queries (outside nesting for proper CSS structure)
   ============================================================================ */

  /* Windows High Contrast / forced-colors mode support */
  @media (forced-colors: active) {
    tbw-grid {
      --tbw-color-border: CanvasText;
      --tbw-color-border-strong: CanvasText;
      --tbw-color-border-cell: CanvasText;
      --tbw-color-border-header: CanvasText;
      --tbw-color-fg: CanvasText;
      --tbw-color-bg: Canvas;
      --tbw-color-panel-bg: Canvas;
      --tbw-color-header-bg: Canvas;
      --tbw-color-header-fg: CanvasText;
      --tbw-color-accent: Highlight;
      --tbw-color-accent-fg: HighlightText;
      --tbw-color-selection: Highlight;
      --tbw-color-row-hover: Highlight;
      --tbw-focus-outline: 2px solid Highlight;
      --tbw-range-border-color: Highlight;

      .cell:focus,
      .cell.active-cell {
        outline: 2px solid Highlight !important;
        outline-offset: -2px;
      }

      .data-grid-row[aria-selected='true'] {
        background: Highlight !important;
        color: HighlightText !important;
      }
    }
  }

  /* Respect prefers-reduced-motion */
  @media (prefers-reduced-motion: reduce) {
    tbw-grid[data-animation-mode='reduced-motion'] {
      --tbw-animation-enabled: 0;
      --tbw-animation-duration: 0ms;
    }
  }

  /* ============================================================================
   Keyframes (must be at root level)
   ============================================================================ */

  @keyframes tbw-expand {
    from {
      opacity: 0;
      max-height: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      max-height: 500px;
      transform: translateY(0);
    }
  }

  @keyframes tbw-collapse {
    from {
      opacity: 1;
      max-height: 500px;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      max-height: 0;
      transform: translateY(-8px);
    }
  }

  /* ============================================================================
   Row Animations (change/insert/remove)
   Triggered via data-animating attribute on .data-grid-row
   ============================================================================ */

  @keyframes tbw-row-change {
    0% {
      background-color: transparent;
    }
    20% {
      background-color: var(--tbw-row-change-color);
    }
    100% {
      background-color: transparent;
    }
  }

  @keyframes tbw-row-insert {
    from {
      opacity: 0;
      max-height: 0;
      overflow: hidden;
    }
    to {
      opacity: 1;
      max-height: var(--tbw-row-height, 28px);
      overflow: hidden;
    }
  }

  @keyframes tbw-row-remove {
    from {
      opacity: 1;
      transform: translateY(0);
      max-height: var(--tbw-row-height, 28px);
    }
    to {
      opacity: 0;
      max-height: 0;
      transform: translateY(-8px);
    }
  }

  .data-grid-row[data-animating='change'] {
    animation: tbw-row-change var(--tbw-row-change-duration) ease-out;
  }

  .data-grid-row[data-animating='insert'] {
    animation: tbw-row-insert var(--tbw-row-insert-duration) ease-out;
    will-change: max-height, opacity;
  }

  .data-grid-row[data-animating='remove'] {
    animation: tbw-row-remove var(--tbw-row-remove-duration) ease-out forwards;
    will-change: max-height, opacity, transform;
    pointer-events: none;
  }
} /* End @layer tbw-base */
