import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as PinnedRowsStories from './pinned-rows.stories';

<Meta of={PinnedRowsStories} />

# Pinned Rows (Status Bar) Plugin

The Pinned Rows plugin creates a status bar for aggregations, row counts, or custom content.

## Installation

```ts
import { PinnedRowsPlugin } from '@toolbox-web/grid/plugins/pinned-rows';
```

## Basic Usage

```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [...],
  plugins: [
    new PinnedRowsPlugin({
      position: 'bottom',
      showRowCount: true,
      aggregationRows: [
        {
          id: 'totals',
          aggregators: {
            quantity: 'sum',
            price: { aggFunc: 'sum', formatter: (v) => `$${v.toFixed(2)}` },
          },
          cells: { id: 'Totals:' },
        },
      ],
    }),
  ],
};
```

## Demos

### Default Status Bar

<Canvas of={PinnedRowsStories.Default} withToolbar />
<Controls of={PinnedRowsStories.Default} />

### Multiple Aggregation Rows

<Canvas of={PinnedRowsStories.MultipleAggregations} withToolbar />

### Custom Panels

<Canvas of={PinnedRowsStories.CustomPanels} withToolbar />

## Configuration Options

| Option              | Type                     | Default    | Description                |
| ------------------- | ------------------------ | ---------- | -------------------------- |
| `position`          | `'top' \| 'bottom'`      | `'bottom'` | Status bar position        |
| `showRowCount`      | `boolean`                | `true`     | Display row count          |
| `showSelectedCount` | `boolean`                | `true`     | Display selected row count |
| `showFilteredCount` | `boolean`                | `true`     | Display filtered row count |
| `aggregationRows`   | `AggregationRowConfig[]` | `[]`       | Aggregation footer rows    |
| `customPanels`      | `PinnedRowsPanel[]`      | `[]`       | Custom info bar panels     |

## Aggregation Rows

Configure computed footer/header rows with aggregators:

```ts
new PinnedRowsPlugin({
  aggregationRows: [
    {
      id: 'totals',
      position: 'bottom',
      aggregators: {
        // Simple string aggregator
        quantity: 'sum',
        // Object syntax with formatter
        price: {
          aggFunc: 'sum',
          formatter: (value) => `$${value.toFixed(2)}`,
        },
      },
      cells: { id: 'Totals:', name: '' },
    },
  ],
});
```

### Aggregator Syntax

| Syntax   | Example                                              | Description                |
| -------- | ---------------------------------------------------- | -------------------------- |
| String   | `'sum'`                                              | Built-in aggregator        |
| Function | `(rows, field) => rows.length`                       | Custom aggregator function |
| Object   | `{ aggFunc: 'sum', formatter: (v) => v.toFixed(2) }` | Aggregator with formatter  |

### Built-in Aggregators

`sum`, `avg`, `count`, `min`, `max`, `first`, `last`

## Custom Panels

```ts
new PinnedRowsPlugin({
  customPanels: [
    {
      id: 'info',
      position: 'right',
      render: (ctx) => `<span>Rows: ${ctx.totalRows}</span>`,
    },
  ],
});
```
