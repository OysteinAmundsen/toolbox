import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as PivotStories from './pivot.stories';

<Meta of={PivotStories} />

# Pivot Table Plugin

The Pivot plugin transforms flat data into a pivot table view.

## Installation

```ts
import { PivotPlugin } from '@toolbox-web/grid/plugins/pivot';
```

## Basic Usage

```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [...],
  plugins: [
    new PivotPlugin({
      rowGroupFields: ['region', 'product'],
      columnGroupFields: ['quarter'],
      valueFields: [{ field: 'sales', aggFunc: 'sum', header: 'Total' }],
    }),
  ],
};
```

## Demos

### Default Pivot Table

<Canvas of={PivotStories.Default} withToolbar />
<Controls of={PivotStories.Default} />

### Without Totals

<Canvas of={PivotStories.NoTotals} withToolbar />

### Average Aggregation

<Canvas of={PivotStories.AverageAggregation} withToolbar />

## Configuration Options

| Option              | Type           | Default | Description                                  |
| ------------------- | -------------- | ------- | -------------------------------------------- |
| `rowGroupFields`    | `string[]`     | `[]`    | Row grouping fields                          |
| `columnGroupFields` | `string[]`     | `[]`    | Column grouping fields                       |
| `valueFields`       | `ValueField[]` | `[]`    | Aggregation fields                           |
| `showTotals`        | `boolean`      | `true`  | Show row totals                              |
| `showGrandTotal`    | `boolean`      | `true`  | Show grand total                             |
| `showToolPanel`     | `boolean`      | `true`  | Show pivot tool panel for interactive config |

## Aggregation Functions

`sum`, `avg`, `count`, `min`, `max`, `first`, `last`

## Programmatic-Only Usage

To use pivot transformation without exposing the tool panel UI to users:

```ts
new PivotPlugin({
  showToolPanel: false,
  rowGroupFields: ['region'],
  columnGroupFields: ['quarter'],
  valueFields: [{ field: 'sales', aggFunc: 'sum' }],
});
```

The pivot API methods remain available for programmatic control.

## Programmatic API

```ts
const plugin = grid.getPlugin(PivotPlugin);

plugin.expandGroup(['North', 'Widget A']);
plugin.collapseGroup(['North']);
plugin.expandAll();
plugin.collapseAll();
```

## Events

| Event                | Detail          | Description     |
| -------------------- | --------------- | --------------- |
| `tbw-pivot-expand`   | `{ groupPath }` | Group expanded  |
| `tbw-pivot-collapse` | `{ groupPath }` | Group collapsed |
