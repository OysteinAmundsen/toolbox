import { Meta, Canvas, Source } from '@storybook/addon-docs/blocks';
import * as GridStories from '../src/lib/core/grid.stories';

<Meta title="Grid/Row Animation" />

# Row Animation API

The Grid provides a built-in row animation API for highlighting changes, insertions, and removals with visual feedback. Animations are CSS-based and respect the grid's animation settings.

## Live Demo

Try the interactive demo below. Use the buttons to trigger animations manually, or start auto-simulation to see random row changes at intervals.

<Canvas of={GridStories.RowAnimation} />

## Animation Types

| Type | Description | Default Duration | CSS Variable |
|------|-------------|------------------|--------------|
| `'change'` | Flash highlight for data changes | 500ms | `--tbw-row-change-duration` |
| `'insert'` | Slide-in animation for new rows | 300ms | `--tbw-row-insert-duration` |
| `'remove'` | Fade-out animation for removed rows | 200ms | `--tbw-row-remove-duration` |

## Usage

### Animate by Row Index

Use when you know the row's position in the current data set:

```typescript
// Highlight a row after updating
grid.rows[5].status = 'updated';
grid.animateRow(5, 'change');

// Animate a newly inserted row
grid.rows = [...grid.rows, newRow];
grid.animateRow(grid.rows.length - 1, 'insert');

// Animate multiple rows at once
grid.animateRows([0, 2, 5], 'change');
```

### Animate by Row ID

Use when working with row IDs (more stable when rows are sorted/filtered):

```typescript
// Real-time update handler
socket.on('row-updated', (data) => {
  grid.updateRow(data.id, data.changes);
  grid.animateRowById(data.id, 'change');
});
```

## Automatic Animation with EditingPlugin

When using the **EditingPlugin**, rows are automatically animated with the `'change'` animation after a successful cell or row edit commit. This provides immediate visual feedback to users.

To disable this behavior, set `animation: false` in the grid config:

```typescript
const config: GridConfig = {
  animation: { mode: 'off' },
  // ...
};
```

## Customizing Animation Appearance

### Duration

Override animation durations via CSS custom properties:

```css
tbw-grid {
  --tbw-row-change-duration: 750ms;
  --tbw-row-insert-duration: 400ms;
  --tbw-row-remove-duration: 300ms;
}
```

### Highlight Color

The change animation uses the grid's accent color by default. Customize it:

```css
tbw-grid {
  /* Use a green flash for changes */
  --tbw-row-change-color: rgba(34, 197, 94, 0.25);
}
```

### Custom Keyframes

For completely custom animations, override the keyframes:

```css
@keyframes tbw-row-change {
  0% { background-color: transparent; }
  25% { background-color: var(--tbw-row-change-color); }
  100% { background-color: transparent; }
}

@keyframes tbw-row-insert {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
```

## API Reference

### Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `animateRow` | `(rowIndex: number, type: RowAnimationType) => void` | Animate a single row by index |
| `animateRows` | `(rowIndices: number[], type: RowAnimationType) => void` | Animate multiple rows at once |
| `animateRowById` | `(rowId: string, type: RowAnimationType) => boolean` | Animate a row by its ID. Returns `true` if found. |

### Types

```typescript
type RowAnimationType = 'change' | 'insert' | 'remove';
```

## Best Practices

1. **Use `animateRowById` for real-time updates** - Row indices can change when data is sorted or filtered
2. **Batch animations** - Use `animateRows()` instead of multiple `animateRow()` calls
3. **Respect reduced motion** - The grid automatically respects `prefers-reduced-motion` when `animation.mode: 'reduced-motion'` (default)
4. **Keep durations short** - Long animations can feel sluggish; 200-500ms is ideal
