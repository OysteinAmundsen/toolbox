import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as ClipboardStories from './clipboard.stories';

<Meta of={ClipboardStories} />

# Clipboard Plugin

The Clipboard plugin brings familiar copy/cut/paste functionality to your grid with full keyboard shortcut support (Ctrl+C, Ctrl+X, Ctrl+V). It handles single cells, multi-cell selections, and integrates seamlessly with Excel and other spreadsheet applications via tab-delimited output.

> ðŸ’¡ **Optional Dependency:** Works best with [SelectionPlugin](/docs/grid-plugins-selection--docs) for copying/pasting selected cells. Without SelectionPlugin, copies the entire grid and pastes at row 0, column 0.

## Installation

```ts
import { ClipboardPlugin } from '@toolbox-web/grid/plugins/clipboard';
```

## Basic Usage

Just add the plugin and you're ready to goâ€”keyboard shortcuts work automatically. Configure options like `includeHeaders` for copying column headers or `delimiter` for custom CSV formats.

<Tabs>
  <Tab label="Vanilla JS">
```ts
const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: [
    { field: 'name', header: 'Name' },
    { field: 'email', header: 'Email' },
    { field: 'department', header: 'Department' }
  ],
  plugins: [
    new ClipboardPlugin({
      includeHeaders: true,
      quoteStrings: true, // Wrap text in quotes for CSV compatibility
    }),
  ],
};
```
  </Tab>
  <Tab label="React">
```tsx
import '@toolbox-web/grid-react/features/selection';
import '@toolbox-web/grid-react/features/clipboard';
import { DataGrid } from '@toolbox-web/grid-react';

function MyGrid({ data }) {
  return (
    <DataGrid
      rows={data}
      columns={[
        { field: 'name', header: 'Name' },
        { field: 'email', header: 'Email' },
        { field: 'department', header: 'Department' }
      ]}
      selection="range"
      clipboard={{ includeHeaders: true, quoteStrings: true }}
    />
  );
}
```
  </Tab>
  <Tab label="Vue">
```html
<script setup>
import '@toolbox-web/grid-vue/features/selection';
import '@toolbox-web/grid-vue/features/clipboard';
import { TbwGrid, TbwGridColumn } from '@toolbox-web/grid-vue';

const data = [
  { name: 'Alice', email: 'alice@example.com', department: 'Engineering' },
  { name: 'Bob', email: 'bob@example.com', department: 'Marketing' },
];
</script>

<template>
  <TbwGrid
    :rows="data"
    selection="range"
    :clipboard="{ includeHeaders: true, quoteStrings: true }"
  >
    <TbwGridColumn field="name" header="Name" />
    <TbwGridColumn field="email" header="Email" />
    <TbwGridColumn field="department" header="Department" />
  </TbwGrid>
</template>
```
  </Tab>
  <Tab label="Angular">
```typescript
// Feature imports - enable the [selection] and [clipboard] inputs
import '@toolbox-web/grid-angular/features/selection';
import '@toolbox-web/grid-angular/features/clipboard';

import { Component, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { Grid } from '@toolbox-web/grid-angular';
import type { ColumnConfig } from '@toolbox-web/grid';

@Component({
  selector: 'app-my-grid',
  imports: [Grid],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <tbw-grid
      [rows]="rows"
      [columns]="columns"
      [selection]="'range'"
      [clipboard]="{ includeHeaders: true, quoteStrings: true }"
      style="height: 400px; display: block;">
    </tbw-grid>
  `,
})
export class MyGridComponent {
  rows = [...];

  columns: ColumnConfig[] = [
    { field: 'name', header: 'Name' },
    { field: 'email', header: 'Email' },
    { field: 'department', header: 'Department' }
  ];
}
```
  </Tab>
</Tabs>

## Demos

### Default Clipboard

Select cells and use Ctrl+C to copy, Ctrl+V to paste.

<Canvas of={ClipboardStories.Default} withToolbar />
<Controls of={ClipboardStories.Default} />

### With Headers

Include column headers when copying.

<Canvas of={ClipboardStories.WithHeaders} withToolbar />

### Quoted Strings

Wrap text values in quotes for CSV compatibility.

<Canvas of={ClipboardStories.QuotedStrings} withToolbar />

### Copy & Paste (Auto-Paste)

By default, the ClipboardPlugin handles paste operations automaticallyâ€”no event handling needed.
Just add the plugin and paste works out of the box.

<Canvas of={ClipboardStories.CopyPaste} withToolbar />

### Custom Paste Handler

For advanced use cases, provide a custom `pasteHandler` to validate, transform, or integrate with state management.

<Canvas of={ClipboardStories.CustomPasteHandler} withToolbar />

## Configuration Options

| Option           | Type                                  | Default              | Description                                                                                              |
| ---------------- | ------------------------------------- | -------------------- | -------------------------------------------------------------------------------------------------------- |
| `includeHeaders` | `boolean`                             | `false`              | Include column headers in copied data                                                                    |
| `delimiter`      | `string`                              | `'\t'`               | Column delimiter (tab for Excel compatibility)                                                           |
| `newline`        | `string`                              | `'\n'`               | Row delimiter                                                                                            |
| `quoteStrings`   | `boolean`                             | `false`              | Wrap string values in quotes                                                                             |
| `processCell`    | `(value, field, row) => string`       | -                    | Custom cell value processor for copy operations                                                          |
| `pasteHandler`   | `PasteHandler \| null`                | `defaultPasteHandler`| Custom paste handler. Set to `null` to disable auto-paste and handle the `paste` event manually         |

## Paste Behavior

The clipboard plugin respects both selection bounds and the `editable` column property when pasting:

### Editable Columns

**Paste only works on columns marked `editable: true`.** Non-editable columns are skipped during paste, preserving column alignment:

```ts
columns: [
  { field: 'id', header: 'ID' },                    // NOT editable - paste skipped
  { field: 'name', header: 'Name', editable: true }, // Paste allowed
  { field: 'email', header: 'Email', editable: true }, // Paste allowed
]
```

If you paste `"1\t2\t3"` into this grid, only the `name` and `email` columns receive values (`2` and `3`). The `id` column remains unchanged.

> ðŸ’¡ **Tip:** This works independently of the EditingPlugin. You can use `editable: true` to control paste behavior even without enabling inline editing.

### Selection Bounds

| Selection Type  | Paste Behavior                                                                 |
| --------------- | ------------------------------------------------------------------------------ |
| Single cell     | Paste expands freely from that cell, adding rows if needed                     |
| Range selection | Paste is clipped to fit within the selected range                              |
| Row selection   | Paste is clipped to the selected rows (all columns within those rows)          |
| No selection    | Paste starts at row 0, column 0                                                |

**Example:** If you have a 2Ã—2 range selected and paste 3Ã—3 data, only the 2Ã—2 portion that fits will be applied.

## Keyboard Shortcuts

| Shortcut           | Action                    |
| ------------------ | ------------------------- |
| `Ctrl+C` / `Cmd+C` | Copy selected cells       |
| `Ctrl+V` / `Cmd+V` | Paste into selected cells |
| `Ctrl+X` / `Cmd+X` | Cut selected cells        |

## Programmatic API

The ClipboardPlugin exposes methods for programmatic copy operations with fine-grained control over which columns and rows to include. This is ideal for workflows where users select rows in the grid, then choose columns via a dialog before copying.

### Basic Copy

```ts
const plugin = grid.getPlugin(ClipboardPlugin);

// Copy current selection to clipboard
await plugin.copy();

// Copy with headers included
await plugin.copy({ includeHeaders: true });
```

### Copy with Column/Row Control (`CopyOptions`)

The `copy()` method accepts `CopyOptions` to precisely control what gets copiedâ€”independently of the current selection:

```ts
const plugin = grid.getPlugin(ClipboardPlugin);

// Copy specific columns from specific rows
await plugin.copy({
  rowIndices: [0, 3, 7],         // Non-contiguous rows supported
  columns: ['name', 'email'],    // Only these columns
  includeHeaders: true,
});

// Copy specific rows with all visible columns
await plugin.copyRows([0, 5]);

// Copy specific rows with column filter
await plugin.copyRows([0, 5], { columns: ['name', 'department'] });
```

### Preview Without Copying

Use `getSelectionAsText()` to get the formatted text without writing to the clipboardâ€”useful for preview dialogs:

```ts
const text = plugin.getSelectionAsText({
  columns: ['name', 'email', 'department'],
  includeHeaders: true,
});
// "Name\tEmail\tDepartment\nAlice\talice@example.com\tEngineering\n..."
```

### `CopyOptions` Reference

| Option           | Type                            | Default       | Description                                        |
| ---------------- | ------------------------------- | ------------- | -------------------------------------------------- |
| `columns`        | `string[]`                      | -             | Specific column fields to include                  |
| `rowIndices`     | `number[]`                      | -             | Specific row indices to copy (non-contiguous OK)   |
| `includeHeaders` | `boolean`                       | config value  | Include column headers in copied text              |
| `delimiter`      | `string`                        | config value  | Column delimiter override                          |
| `newline`        | `string`                        | config value  | Row delimiter override                             |
| `processCell`    | `(value, field, row) => string` | config value  | Custom cell value processor for this operation     |

### Paste

```ts
// Paste from clipboard
await plugin.paste();

// Get last copied info
const lastCopied = plugin.getLastCopied();
// { text: '...', timestamp: 1234567890 }
```

## Excel Compatibility

The default tab delimiter ensures copied data pastes correctly into Excel:

```ts
new ClipboardPlugin({
  delimiter: '\t', // Tab for Excel
  includeHeaders: true, // Include column names
});
```

## Styling

The clipboard plugin doesn't add visible UI elements. Selection styling is handled by the SelectionPlugin.

## See Also

- **[Selection](../?path=/docs/grid-plugins-selection--docs)** â€” Cell and row selection
- **[Editing](../?path=/docs/grid-plugins-editing--docs)** â€” Inline cell editing
- **[Export](../?path=/docs/grid-plugins-export--docs)** â€” Export to CSV/JSON
