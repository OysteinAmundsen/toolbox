import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import { Tabs, Tab } from '../../../../../../apps/docs/.storybook/components/Tabs';
import * as ColumnVirtualizationStories from './column-virtualization.stories';

<Meta of={ColumnVirtualizationStories} />

# Column Virtualization Plugin

The Column Virtualization plugin improves performance for grids with many columns.

## Installation

```ts
import { ColumnVirtualizationPlugin } from '@toolbox-web/grid/plugins/column-virtualization';
```

## Basic Usage

<Tabs>
  <Tab label="Vanilla JS">
```ts
import '@toolbox-web/grid';
import { ColumnVirtualizationPlugin } from '@toolbox-web/grid/plugins/column-virtualization';

const grid = document.querySelector('tbw-grid');
grid.gridConfig = {
  columns: generateManyColumns(100), // Your column generator
  fitMode: 'fixed', // Required for column virtualization
  plugins: [new ColumnVirtualizationPlugin()],
};
grid.rows = data;
```
  </Tab>
  <Tab label="React">
```tsx
import '@toolbox-web/grid-react/features/column-virtualization';
import { DataGrid } from '@toolbox-web/grid-react';

function WideGrid({ data }) {
  return (
    <DataGrid
      rows={data}
      columns={generateManyColumns(100)}
      fitMode="fixed"
      columnVirtualization
      style={{ height: '400px' }}
    />
  );
}
```
  </Tab>
  <Tab label="Vue">
```html
<script setup>
import '@toolbox-web/grid-vue/features/column-virtualization';
import { TbwGrid } from '@toolbox-web/grid-vue';

const data = [{ col0: 'Row 1', col1: 'Value 1' }, { col0: 'Row 2', col1: 'Value 2' }];

const columns = Array.from({ length: 100 }, (_, i) => ({
  field: `col${i}`,
  header: `Column ${i + 1}`,
  width: 120,
}));
</script>

<template>
  <TbwGrid :rows="data" :columns="columns" fit-mode="fixed" column-virtualization style="height: 400px">
  </TbwGrid>
</template>
```
  </Tab>
  <Tab label="Angular">
```typescript
// Feature import - enables the [columnVirtualization] input
import '@toolbox-web/grid-angular/features/column-virtualization';

import { Component, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { Grid } from '@toolbox-web/grid-angular';
import type { ColumnConfig } from '@toolbox-web/grid';

@Component({
  selector: 'app-wide-grid',
  imports: [Grid],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <tbw-grid
      [rows]="rows"
      [columns]="columns"
      [columnVirtualization]="true"
      fitMode="fixed"
      style="height: 400px; display: block;">
    </tbw-grid>
  `,
})
export class WideGridComponent {
  rows = [...];
  columns: ColumnConfig[] = this.generateManyColumns(100);

  generateManyColumns(count: number): ColumnConfig[] {
    return Array.from({ length: count }, (_, i) => ({
      field: `col${i}`,
      header: `Column ${i + 1}`,
      width: 120,
    }));
  }
}
```
  </Tab>
</Tabs>

## Demos

### Default Column Virtualization

<Canvas of={ColumnVirtualizationStories.Default} withToolbar />
<Controls of={ColumnVirtualizationStories.Default} />

### Wide Grid (100 columns)

<Canvas of={ColumnVirtualizationStories.WideGrid} withToolbar />

### Disabled Virtualization

<Canvas of={ColumnVirtualizationStories.DisabledVirtualization} withToolbar />

## Configuration Options

| Option       | Type      | Default | Description                 |
| ------------ | --------- | ------- | --------------------------- |
| `autoEnable` | `boolean` | `true`  | Auto-enable above threshold |
| `threshold`  | `number`  | `30`    | Column count threshold      |
| `overscan`   | `number`  | `3`     | Extra columns to render     |

## Requirements

- `fitMode: 'fixed'` is required
- Columns must have explicit widths
- Grid must have fixed height

## Programmatic API

```ts
const plugin = grid.getPlugin(ColumnVirtualizationPlugin);

const isEnabled = plugin.isEnabled();
plugin.setEnabled(true);
const range = plugin.getVisibleRange();
```
